} else {
df <- boosteddf
}
percentreduc50 <- ggplot(df, aes(x = phi*100, y = psi*100)) + #, colour = ..level..)) +
geom_tile(aes_string(fill = fill_50)) +
geom_contour(aes_string(z = Reff_50), breaks = 1, size = 0.6, color = "white") +
geom_contour(aes(z = Reff), breaks = 1, size = 0.6, col = "white", linetype = "longdash") +
scale_y_continuous(expand = c(0, 0)) +
scale_x_continuous(expand = c(0, 0)) +
ylab("") +#"Infection-acquired immunity (%)") +
xlab("") +# xlab("Population vaccination rate (%)") +
ggtitle("") +
scale_fill_gradientn(colours = cet_pal(5, name = "inferno"), limits = c(0, 100)) +
coord_fixed(1) +
theme(legend.position = "none")
percentreduc99 <- ggplot(df, aes(x = phi*100, y = psi*100)) + #, colour = ..level..)) +
geom_tile(aes_string(fill = fill_99)) +
geom_contour(aes_string(z = Reff_99), breaks = 1, size = 0.6, col = "white") +
geom_contour(aes(z = Reff), breaks = 1, size = 0.6, col = "white", linetype = "longdash") +
scale_y_continuous(expand = c(0, 0)) +
scale_x_continuous(expand = c(0, 0)) +
ylab("Infection-acquired immunity (%)") +
xlab("") +# xlab("Population vaccination rate (%)") +
#ggtitle("Weekly testing, 99% compliance", "% reduction in infections due to testing") +
scale_fill_gradientn(colours = cet_pal(5, name = "inferno"), limits = c(0, 100)) +
coord_fixed(1) +
labs(fill = "") +
theme(axis.title.y = element_blank(),
plot.title = element_blank(),
plot.subtitle = element_blank()) #element_text(hjust = 0.5))
percent_legend <- get_legend(percentreduc99)
if (i == 1){
percentreduc50_waning <- percentreduc50 + onlyy_theme
percentreduc99_waning <- percentreduc99 + theme(legend.position = "none", plot.title = element_blank())
if (m == "inf_testeveryone") {
percentreduc50_waning <- percentreduc50_waning + ggtitle("Waning/low VE") }
if (m == "hosp_uonly") {
percentreduc99_waning <- percentreduc99_waning + alllabels_theme }
else { percentreduc99_waning <- percentreduc99_waning + onlyy_theme }
} else if (i == 2){
percentreduc50_baseline <- percentreduc50 + nolabels_theme
percentreduc99_baseline <- percentreduc99 + theme(legend.position = "none", plot.title = element_blank())
if (m == "inf_testeveryone") {
percentreduc50_baseline <- percentreduc50_baseline + ggtitle("Baseline VE") }
if (m == "hosp_uonly") {
percentreduc99_baseline <- percentreduc99_baseline + onlyx_theme +  xlab("Population vaccination rate (%)") }
else { percentreduc99_baseline <- percentreduc99_baseline + nolabels_theme }
} else {
percentreduc50_boosted <- percentreduc50 + nolabels_theme
percentreduc99_boosted <- percentreduc99 + theme(legend.position = "none", plot.title = element_blank())
if (m == "inf_testeveryone") {
percentreduc50_boosted <- percentreduc50_boosted + ggtitle("Boosted/high VE") }
if (m == "hosp_uonly") {
percentreduc99_boosted <- percentreduc99_boosted + onlyx_theme }
else { percentreduc99_boosted <- percentreduc99_boosted + nolabels_theme }
}
}
if (m == "inf_testeveryone"){
inf_everyone_panel <- ggarrange(percentreduc50_waning, NULL, percentreduc50_baseline, NULL, percentreduc50_boosted,
NULL, NULL, NULL, NULL, NULL,
percentreduc99_waning, NULL, percentreduc99_baseline, NULL, percentreduc99_boosted,
nrow = 3, ncol = 5,
align = "hv",
widths = c(1, -0.14, 1, -0.14, 1),
heights = c(1, -0.22, 1),
labels = c("a", NA, "    b", NA,"    c",
NA, NA, NA, NA, NA,
"d", NA, "    e", NA, "    f"),
label.y = 0.88)
}
if (m == "hosp_testeveryone"){
hosp_everyone_panel <- ggarrange(percentreduc50_waning, NULL, percentreduc50_baseline, NULL, percentreduc50_boosted,
NULL, NULL, NULL, NULL, NULL,
percentreduc99_waning, NULL, percentreduc99_baseline, NULL, percentreduc99_boosted,
nrow = 3, ncol = 5,
align = "hv",
widths = c(1, -0.14, 1, -0.14, 1),
heights = c(1, -0.22, 1),
labels = c("g", NA, "    h", NA,"    i",
NA, NA, NA, NA, NA,
"j", NA, "    k", NA, "    l"),
label.y = 0.88)
}
if (m == "hosp_uonly"){
hosp_uonly_panel <-ggarrange(percentreduc50_waning, NULL, percentreduc50_baseline, NULL, percentreduc50_boosted,
NULL, NULL, NULL, NULL, NULL,
percentreduc99_waning, NULL, percentreduc99_baseline, NULL, percentreduc99_boosted,
nrow = 3, ncol = 5,
align = "hv",
widths = c(1, -0.14, 1, -0.14, 1),
heights = c(1, -0.22, 1),
labels = c("m", NA, "    n", NA,"    o",
NA, NA, NA, NA, NA,
"p", NA, "    q", NA, "    r"),
label.y = 0.88)
}
}
for (m in megafig_scenarios){
base <- "percent_reduc_"
if (m == "hosp_testeveryone"){
fill_50 <- paste0(base,"hosp_50_testeveryone")
fill_99 <- paste0(base,"hosp_99_testeveryone")
Reff_50 <- "Reff_50_everyone"
Reff_99 <- "Reff_99_everyone"
}
if (m == "hosp_uonly"){
fill_50 <-"percent_reduc_hosp_50_uonly"
fill_99 <- "percent_reduc_hosp_99_uonly"
Reff_50 <- "Reff_50_uonly"
Reff_99 <- "Reff_99_uonly"
}
if (m == "inf_testeveryone"){
fill_50 <- paste0(base,"inf_50_testeveryone")
fill_99 <- paste0(base,"inf_99_testeveryone")
Reff_50 <- "Reff_50_everyone"
Reff_99 <- "Reff_99_everyone"
}
#* II: Plot suppfig5 ####
for (i in 1:3) {
if (i == 1) {
df <- waningdf
} else if (i==2) {
df <- baselinedf
} else {
df <- boosteddf
}
percentreduc50 <- ggplot(df, aes(x = phi*100, y = psi*100)) + #, colour = ..level..)) +
geom_raster(aes_string(fill = fill_50)) +
geom_contour(aes_string(z = Reff_50), breaks = 1, size = 0.6, color = "white") +
geom_contour(aes(z = Reff), breaks = 1, size = 0.6, col = "white", linetype = "longdash") +
scale_y_continuous(expand = c(0, 0)) +
scale_x_continuous(expand = c(0, 0)) +
ylab("") +#"Infection-acquired immunity (%)") +
xlab("") +# xlab("Population vaccination rate (%)") +
ggtitle("") +
scale_fill_gradientn(colours = cet_pal(5, name = "inferno"), limits = c(0, 100)) +
coord_fixed(1) +
theme(legend.position = "none")
percentreduc99 <- ggplot(df, aes(x = phi*100, y = psi*100)) + #, colour = ..level..)) +
geom_raster(aes_string(fill = fill_99)) +
geom_contour(aes_string(z = Reff_99), breaks = 1, size = 0.6, col = "white") +
geom_contour(aes(z = Reff), breaks = 1, size = 0.6, col = "white", linetype = "longdash") +
scale_y_continuous(expand = c(0, 0)) +
scale_x_continuous(expand = c(0, 0)) +
ylab("Infection-acquired immunity (%)") +
xlab("") +# xlab("Population vaccination rate (%)") +
#ggtitle("Weekly testing, 99% compliance", "% reduction in infections due to testing") +
scale_fill_gradientn(colours = cet_pal(5, name = "inferno"), limits = c(0, 100)) +
coord_fixed(1) +
labs(fill = "") +
theme(axis.title.y = element_blank(),
plot.title = element_blank(),
plot.subtitle = element_blank()) #element_text(hjust = 0.5))
percent_legend <- get_legend(percentreduc99)
if (i == 1){
percentreduc50_waning <- percentreduc50 + onlyy_theme
percentreduc99_waning <- percentreduc99 + theme(legend.position = "none", plot.title = element_blank())
if (m == "inf_testeveryone") {
percentreduc50_waning <- percentreduc50_waning + ggtitle("Waning/low VE") }
if (m == "hosp_uonly") {
percentreduc99_waning <- percentreduc99_waning + alllabels_theme }
else { percentreduc99_waning <- percentreduc99_waning + onlyy_theme }
} else if (i == 2){
percentreduc50_baseline <- percentreduc50 + nolabels_theme
percentreduc99_baseline <- percentreduc99 + theme(legend.position = "none", plot.title = element_blank())
if (m == "inf_testeveryone") {
percentreduc50_baseline <- percentreduc50_baseline + ggtitle("Baseline VE") }
if (m == "hosp_uonly") {
percentreduc99_baseline <- percentreduc99_baseline + onlyx_theme +  xlab("Population vaccination rate (%)") }
else { percentreduc99_baseline <- percentreduc99_baseline + nolabels_theme }
} else {
percentreduc50_boosted <- percentreduc50 + nolabels_theme
percentreduc99_boosted <- percentreduc99 + theme(legend.position = "none", plot.title = element_blank())
if (m == "inf_testeveryone") {
percentreduc50_boosted <- percentreduc50_boosted + ggtitle("Boosted/high VE") }
if (m == "hosp_uonly") {
percentreduc99_boosted <- percentreduc99_boosted + onlyx_theme }
else { percentreduc99_boosted <- percentreduc99_boosted + nolabels_theme }
}
}
if (m == "inf_testeveryone"){
inf_everyone_panel <- ggarrange(percentreduc50_waning, NULL, percentreduc50_baseline, NULL, percentreduc50_boosted,
NULL, NULL, NULL, NULL, NULL,
percentreduc99_waning, NULL, percentreduc99_baseline, NULL, percentreduc99_boosted,
nrow = 3, ncol = 5,
align = "hv",
widths = c(1, -0.14, 1, -0.14, 1),
heights = c(1, -0.22, 1),
labels = c("a", NA, "    b", NA,"    c",
NA, NA, NA, NA, NA,
"d", NA, "    e", NA, "    f"),
label.y = 0.88)
}
if (m == "hosp_testeveryone"){
hosp_everyone_panel <- ggarrange(percentreduc50_waning, NULL, percentreduc50_baseline, NULL, percentreduc50_boosted,
NULL, NULL, NULL, NULL, NULL,
percentreduc99_waning, NULL, percentreduc99_baseline, NULL, percentreduc99_boosted,
nrow = 3, ncol = 5,
align = "hv",
widths = c(1, -0.14, 1, -0.14, 1),
heights = c(1, -0.22, 1),
labels = c("g", NA, "    h", NA,"    i",
NA, NA, NA, NA, NA,
"j", NA, "    k", NA, "    l"),
label.y = 0.88)
}
if (m == "hosp_uonly"){
hosp_uonly_panel <-ggarrange(percentreduc50_waning, NULL, percentreduc50_baseline, NULL, percentreduc50_boosted,
NULL, NULL, NULL, NULL, NULL,
percentreduc99_waning, NULL, percentreduc99_baseline, NULL, percentreduc99_boosted,
nrow = 3, ncol = 5,
align = "hv",
widths = c(1, -0.14, 1, -0.14, 1),
heights = c(1, -0.22, 1),
labels = c("m", NA, "    n", NA,"    o",
NA, NA, NA, NA, NA,
"p", NA, "    q", NA, "    r"),
label.y = 0.88)
}
}
lay <- rbind(c(rep(1,10),NA,NA),
c(rep(2,10),3,NA),
c(rep(4,10),NA,NA))
suppfig5 <- grid.arrange(inf_everyone_panel, hosp_everyone_panel, percent_legend, hosp_uonly_panel,
layout_matrix = lay,
heights = c(1,1,1.15),
left = c("Infection-acquired immunity (%)"))
ggsave("suppFig5_megafig.pdf", suppfig5, device = cairo_pdf, width = 6, height = 10)
# Either read in the corresponding RDS file
# Dataframes for main text figure 5
waningdf <- readRDS("dataframes/df_Fig5_waning.RData")
baselinedf <- readRDS("dataframes/df_Fig5_baseline.RData")
boosteddf <- readRDS("dataframes/df_Fig5_boosted.RData")
# setup.R works correctly if you've already installed fonts. if not, go to setup.R line 22.
source("setup.R")
testing_everyone <- 0 # if 0, just testing unvacc. when implementing testing
# Dataframe for supp text figure 4 - R0 = 6
df <- readRDS("dataframes/df_SuppFig6_R06.RData")
testing_everyone <- 0
R0 <- 6
alpha <- R0*gamma/N # transmissibility
df_timeseries <- data.frame(time = t)
this_phi <- 0.58
theta_vec <- c(0, theta_50, theta_99, theta_99_biwk)
for (i in 1:4){
this_theta <- theta_vec[i]
temp <- run_leaky_model(this_phi, this_VE_I, this_VE_S, this_theta, this_q,
psi = this_psi, X_I = this_X_I, X_S = this_X_S,
H_I = this_H_I, H_S = this_H_S)
I_tot <- temp$I_v + temp$I_u + temp$I_x + temp$I_h
if (i == 1){
df_timeseries$notesting <- I_tot
} else if (i == 2){
df_timeseries$testing50 <- I_tot
} else if (i == 3){
df_timeseries$testing99 <- I_tot
} else {
df_timeseries$testing99_biwk <- I_tot
}
}
plot_timeseries <- ggplot(df_timeseries, aes(x = time)) +
geom_line(aes(y = notesting/1000), col = "black", size = 0.8) +
geom_line(aes(y = testing50/1000), col = theta50_purple, size = 0.8) +
geom_line(aes(y = testing99/1000), col = theta99_purple, size = 0.8) +
geom_line(aes(y = testing99_biwk/1000), col = thetabiwk_purple, size = 0.8) +
ggtitle("\n") + # just for formatting
ylab("Infected (#)") +
xlab("Time (days)") +
scale_x_continuous(expand = c(0, 0), limits = c(0, 200)) +
scale_y_continuous(expand = c(0, 0), limits = c(0, 5000/1000)) + # 5000 for R0 = 6
alllabels_theme +
#coord_fixed(200/3.5) +
coord_fixed(200/5) + # for R0 = 6
theme(plot.margin = margin(10, 10, 10, 10))
percentreduc50 <- ggplot(df, aes(x = phi*100, y = psi*100)) + #, colour = ..level..)) +
geom_raster(aes(fill = percent_reduc_inf_50)) +
geom_contour(aes(z = Reff_50), breaks = 1, size = 0.6, color = "white") +
geom_contour(aes(z = Reff), breaks = 1, size = 0.6, col = "white", linetype = "longdash") +
scale_y_continuous(expand = c(0, 0)) +
scale_x_continuous(expand = c(0, 0)) +
geom_point(aes(x = 58, y = 35), color = "white", size = 0.2) +
ylab("Infection-acquired immunity (%)") +
xlab("") +# xlab("Population vaccination rate (%)") +
ggtitle("") +
scale_fill_gradientn(colours = cet_pal(5, name = "inferno"), limits = c(0, 100)) +
coord_fixed(1) +
theme(legend.position = "none")
percentreduc99 <- ggplot(df, aes(x = phi*100, y = psi*100)) + #, colour = ..level..)) +
geom_raster(aes(fill = percent_reduc_inf_99)) +
geom_contour(aes(z = Reff_99), breaks = 1, size = 0.6, col = "white") +
geom_contour(aes(z = Reff), breaks = 1, size = 0.6, col = "white", linetype = "longdash") +
scale_y_continuous(expand = c(0, 0)) +
scale_x_continuous(expand = c(0, 0)) +
geom_point(aes(x = 58, y = 35), color = "white", size = 0.2) +
ylab("Infection-acquired immunity (%)") +
xlab("") +# xlab("Population vaccination rate (%)") +
ggtitle("Weekly testing, 99% compliance", "% reduction in infections due to testing") +
scale_fill_gradientn(colours = cet_pal(5, name = "inferno"), limits = c(0, 100)) +
coord_fixed(1) +
labs(fill = "") +
theme(axis.title.y = element_blank(),
plot.title = element_blank(),
plot.subtitle = element_blank()) #element_text(hjust = 0.5))
percentreducbiwk <- ggplot(df, aes(x = phi*100, y = psi*100)) + #, colour = ..level..)) +
geom_raster(aes(fill = percent_reduc_inf_biwk)) +
geom_contour(aes(z = Reff_biwk), breaks = 1, size = 0.6, col = "white") +
geom_contour(aes(z = Reff), breaks = 1, size = 0.6, col = "white", linetype = "longdash") +
scale_y_continuous(expand = c(0, 0)) +
scale_x_continuous(expand = c(0, 0)) +
geom_point(aes(x = 58, y = 35), color = "white", size = 0.2) +
ylab("Infection-acquired immunity (%)") +
xlab("") +# xlab("Population vaccination rate (%)") +
ggtitle("Biweekly testing, 99% compliance", "% reduction in infections due to testing") +
scale_fill_gradientn(colours = cet_pal(5, name = "inferno"), limits = c(0, 100)) +
coord_fixed(1) +
labs(fill = "") +
theme(axis.title.y = element_blank(),
plot.title = element_blank(),
plot.subtitle = element_blank()) #element_text(hjust = 0.5))
percentreducbiwk <- addSmallLegend(percentreducbiwk)
percent_legend <- get_legend(percentreducbiwk)
percentreduc50_baseline <- percentreduc50 + alllabels_theme + ggtitle("Weekly testing,\n50% Compliance")
percentreduc99_baseline <- percentreduc99 + onlyx_theme +
theme(legend.position = "none") + ggtitle("Weekly testing,\n99% Compliance") +
xlab("Population vaccination rate (%)")
percentreducbiwk_baseline <- percentreducbiwk + onlyx_theme + ggtitle("Biweekly testing,\n99% Compliance")
panels <- ggarrange(percentreduc50_baseline, NULL,
percentreduc99_baseline, NULL,
percentreducbiwk_baseline,
nrow = 1, ncol = 5,
align = "hv",
widths = c(1, -0.16, 1, -0.16, 1),
heights = c(1),
labels = c("    a", "b", NA,"c", NA),
label.y = 1)
timeseries <- ggarrange(NULL, plot_timeseries, NULL,
nrow = 1, ncol = 3,
widths = c(0.2, 1, 0.2),
heights = c(1),
align = "hv",
labels = c(NA, "d", NA))
lay <- rbind(c(1, 2, 3))
fig6 <- arrangeGrob(panels, percent_legend, plot_timeseries, layout_matrix = lay,
widths = c(2.8, 0.2, 1))
ggsave("SuppFig6.svg", fig6, device = svg, width = 8, height = 2.5)
## Dataframe for supp text figure 4 - R0 = 6
df <- readRDS("dataframes/df_SuppFig6_R06.RData")
testing_everyone <- 0
R0 <- 6
alpha <- R0*gamma/N # transmissibility
df_timeseries <- data.frame(time = t)
this_phi <- 0.58
theta_vec <- c(0, theta_50, theta_99, theta_99_biwk)
for (i in 1:4){
this_theta <- theta_vec[i]
temp <- run_leaky_model(this_phi, this_VE_I, this_VE_S, this_theta, this_q,
psi = this_psi, X_I = this_X_I, X_S = this_X_S,
H_I = this_H_I, H_S = this_H_S)
I_tot <- temp$I_v + temp$I_u + temp$I_x + temp$I_h
if (i == 1){
df_timeseries$notesting <- I_tot
} else if (i == 2){
df_timeseries$testing50 <- I_tot
} else if (i == 3){
df_timeseries$testing99 <- I_tot
} else {
df_timeseries$testing99_biwk <- I_tot
}
}
plot_timeseries <- ggplot(df_timeseries, aes(x = time)) +
geom_line(aes(y = notesting/1000), col = "black", size = 0.8) +
geom_line(aes(y = testing50/1000), col = theta50_purple, size = 0.8) +
geom_line(aes(y = testing99/1000), col = theta99_purple, size = 0.8) +
geom_line(aes(y = testing99_biwk/1000), col = thetabiwk_purple, size = 0.8) +
ggtitle("\n") + # just for formatting
ylab("Infected (#)") +
xlab("Time (days)") +
scale_x_continuous(expand = c(0, 0), limits = c(0, 200)) +
scale_y_continuous(expand = c(0, 0), limits = c(0, 5000/1000)) + # 5000 for R0 = 6
alllabels_theme +
#coord_fixed(200/3.5) +
coord_fixed(200/5) + # for R0 = 6
theme(plot.margin = margin(10, 10, 10, 10))
plot_timeseries
this_X_S <- omicron_X_S
this_X_I <- omicron_X_I
this_VE_S <- omicron_VE_S
this_VE_I <- omicron_VE_I
this_H_S <- omicron_H_S
this_H_I <- omicron_H_I
df <- readRDS("dataframes/df_SuppFig6_R06.RData")
testing_everyone <- 0
R0 <- 6
alpha <- R0*gamma/N # transmi
df_timeseries <- data.frame(time = t)
this_phi <- 0.58
theta_vec <- c(0, theta_50, theta_99, theta_99_biwk)
for (i in 1:4){
this_theta <- theta_vec[i]
temp <- run_leaky_model(this_phi, this_VE_I, this_VE_S, this_theta, this_q,
psi = this_psi, X_I = this_X_I, X_S = this_X_S,
H_I = this_H_I, H_S = this_H_S)
I_tot <- temp$I_v + temp$I_u + temp$I_x + temp$I_h
if (i == 1){
df_timeseries$notesting <- I_tot
} else if (i == 2){
df_timeseries$testing50 <- I_tot
} else if (i == 3){
df_timeseries$testing99 <- I_tot
} else {
df_timeseries$testing99_biwk <- I_tot
}
}
plot_timeseries <- ggplot(df_timeseries, aes(x = time)) +
geom_line(aes(y = notesting/1000), col = "black", size = 0.8) +
geom_line(aes(y = testing50/1000), col = theta50_purple, size = 0.8) +
geom_line(aes(y = testing99/1000), col = theta99_purple, size = 0.8) +
geom_line(aes(y = testing99_biwk/1000), col = thetabiwk_purple, size = 0.8) +
ggtitle("\n") + # just for formatting
ylab("Infected (#)") +
xlab("Time (days)") +
scale_x_continuous(expand = c(0, 0), limits = c(0, 200)) +
scale_y_continuous(expand = c(0, 0), limits = c(0, 5000/1000)) + # 5000 for R0 = 6
alllabels_theme +
#coord_fixed(200/3.5) +
coord_fixed(200/5) + # for R0 = 6
theme(plot.margin = margin(10, 10, 10, 10))
percentreduc50 <- ggplot(df, aes(x = phi*100, y = psi*100)) + #, colour = ..level..)) +
geom_raster(aes(fill = percent_reduc_inf_50)) +
geom_contour(aes(z = Reff_50), breaks = 1, size = 0.6, color = "white") +
geom_contour(aes(z = Reff), breaks = 1, size = 0.6, col = "white", linetype = "longdash") +
scale_y_continuous(expand = c(0, 0)) +
scale_x_continuous(expand = c(0, 0)) +
geom_point(aes(x = 58, y = 35), color = "white", size = 0.2) +
ylab("Infection-acquired immunity (%)") +
xlab("") +# xlab("Population vaccination rate (%)") +
ggtitle("") +
scale_fill_gradientn(colours = cet_pal(5, name = "inferno"), limits = c(0, 100)) +
coord_fixed(1) +
theme(legend.position = "none")
plot_timeseries
percentreduc50 <- ggplot(df, aes(x = phi*100, y = psi*100)) + #, colour = ..level..)) +
geom_raster(aes(fill = percent_reduc_inf_50)) +
geom_contour(aes(z = Reff_50), breaks = 1, size = 0.6, color = "white") +
geom_contour(aes(z = Reff), breaks = 1, size = 0.6, col = "white", linetype = "longdash") +
scale_y_continuous(expand = c(0, 0)) +
scale_x_continuous(expand = c(0, 0)) +
geom_point(aes(x = 58, y = 35), color = "white", size = 0.2) +
ylab("Infection-acquired immunity (%)") +
xlab("") +# xlab("Population vaccination rate (%)") +
ggtitle("") +
scale_fill_gradientn(colours = cet_pal(5, name = "inferno"), limits = c(0, 100)) +
coord_fixed(1) +
theme(legend.position = "none")
percentreduc99 <- ggplot(df, aes(x = phi*100, y = psi*100)) + #, colour = ..level..)) +
geom_raster(aes(fill = percent_reduc_inf_99)) +
geom_contour(aes(z = Reff_99), breaks = 1, size = 0.6, col = "white") +
geom_contour(aes(z = Reff), breaks = 1, size = 0.6, col = "white", linetype = "longdash") +
scale_y_continuous(expand = c(0, 0)) +
scale_x_continuous(expand = c(0, 0)) +
geom_point(aes(x = 58, y = 35), color = "white", size = 0.2) +
ylab("Infection-acquired immunity (%)") +
xlab("") +# xlab("Population vaccination rate (%)") +
ggtitle("Weekly testing, 99% compliance", "% reduction in infections due to testing") +
scale_fill_gradientn(colours = cet_pal(5, name = "inferno"), limits = c(0, 100)) +
coord_fixed(1) +
labs(fill = "") +
theme(axis.title.y = element_blank(),
plot.title = element_blank(),
plot.subtitle = element_blank()) #element_text(hjust = 0.5))
percentreducbiwk <- ggplot(df, aes(x = phi*100, y = psi*100)) + #, colour = ..level..)) +
geom_raster(aes(fill = percent_reduc_inf_biwk)) +
geom_contour(aes(z = Reff_biwk), breaks = 1, size = 0.6, col = "white") +
geom_contour(aes(z = Reff), breaks = 1, size = 0.6, col = "white", linetype = "longdash") +
scale_y_continuous(expand = c(0, 0)) +
scale_x_continuous(expand = c(0, 0)) +
geom_point(aes(x = 58, y = 35), color = "white", size = 0.2) +
ylab("Infection-acquired immunity (%)") +
xlab("") +# xlab("Population vaccination rate (%)") +
ggtitle("Biweekly testing, 99% compliance", "% reduction in infections due to testing") +
scale_fill_gradientn(colours = cet_pal(5, name = "inferno"), limits = c(0, 100)) +
coord_fixed(1) +
labs(fill = "") +
theme(axis.title.y = element_blank(),
plot.title = element_blank(),
plot.subtitle = element_blank()) #element_text(hjust = 0.5))
percentreducbiwk <- addSmallLegend(percentreducbiwk)
percent_legend <- get_legend(percentreducbiwk)
percentreduc50_baseline <- percentreduc50 + alllabels_theme + ggtitle("Weekly testing,\n50% Compliance")
percentreduc99_baseline <- percentreduc99 + onlyx_theme +
theme(legend.position = "none") + ggtitle("Weekly testing,\n99% Compliance") +
xlab("Population vaccination rate (%)")
percentreducbiwk_baseline <- percentreducbiwk + onlyx_theme + ggtitle("Biweekly testing,\n99% Compliance")
panels <- ggarrange(percentreduc50_baseline, NULL,
percentreduc99_baseline, NULL,
percentreducbiwk_baseline,
nrow = 1, ncol = 5,
align = "hv",
widths = c(1, -0.16, 1, -0.16, 1),
heights = c(1),
labels = c("    a", "b", NA,"c", NA),
label.y = 1)
timeseries <- ggarrange(NULL, plot_timeseries, NULL,
nrow = 1, ncol = 3,
widths = c(0.2, 1, 0.2),
heights = c(1),
align = "hv",
labels = c(NA, "d", NA))
lay <- rbind(c(1, 2, 3))
fig6 <- arrangeGrob(panels, percent_legend, plot_timeseries, layout_matrix = lay,
widths = c(2.8, 0.2, 1))
ggsave("SuppFig6.svg", fig6, device = svg, width = 8, height = 2.5)
