# plot Reff
p_Reff <- ggplot(df, aes(x = phi*100, y = psi*100, z = Reff))+ #, colour = ..level..)) +
geom_tile(aes(fill = tot_infections)) +
geom_contour(breaks = 1:R0, size = 0.4, color = "white") +
geom_text_contour(breaks = 1:R0, color = "white", rotate = FALSE,
nudge_y = 1,
nudge_x = 4)+
#stat_contour(breaks = 1:R0, size = 1, color = "white") +
scale_y_continuous(expand = c(0, 0)) +
scale_x_continuous(expand = c(0, 0)) +
ylab("Infection-acquired immunity (%)") +
xlab("") +# xlab("Population vaccination rate (%)") +
#ggtitle(expression(R[eff])) +
ggtitle("Total infections") +
scale_fill_viridis(option="viridis", limits = c(0, N)) +
coord_fixed(1) +
labs(fill = "") +
theme(legend.text = element_text(size = 11),
legend.spacing.x = unit(0.7, 'cm'))
p_Reff
# plot % infections in the unvaccinated
p_infection <- ggplot(df, aes(x = phi*100, y = psi*100, z = breakthrough)) +
geom_tile(aes(fill = 100 - breakthrough)) +
stat_contour(breaks = c(50), size = 0.4, col = "white") +
scale_y_continuous(expand = c(0,0)) +
scale_x_continuous(expand = c(0,0)) +
ylab("") + # ylab("Infection-acquired immunity (%)") +
xlab("Population vaccination rate (%)") +
ggtitle("% of infections among\nunvaccinated individuals") +
labs(fill = "Percent\ninfections\nin vacc.") +
theme(legend.text = element_text(size = 11),
legend.title = element_text(size = 11),
legend.title.align = 0.5,
legend.spacing.x = unit(0.5, 'cm'),
legend.position = "none") +
scale_fill_gradientn(colours = cet_pal(5, name = "inferno")) +
coord_fixed(1)
# plot dominant transmission
p_transmission <- ggplot(df, aes(x = phi*100, y = psi*100, z = dom_transmission)) +
geom_tile(aes(fill = dom_transmission)) +
stat_contour(breaks = c(50), size = 0.4, color = "white") +
scale_y_continuous(expand = c(0,0)) +
scale_x_continuous(expand = c(0,0)) +
ylab("") + # ylab("Infection-acquired immunity (%)") +
xlab("") + # xlab("Population vaccination rate (%)") +
ggtitle("% of transmission from\nunvaccinated individuals") +
labs(fill = "")+ #"Percent of\ntransmission\nby unvacc.") +
theme(legend.text = element_text(size = 11),
legend.title = element_text(size = 11),
legend.title.align = 0.5,
legend.spacing.x = unit(0.45, 'cm')) +
scale_fill_gradientn(colours = cet_pal(5, name = "inferno"))+
coord_fixed(1)
ggarrange(p_Reff, p_infection,
p_transmission,
widths = c(1.26, 1, 1.23),
labels = c('a  ', 'b', 'c'),
ncol = 3,
label.y = 0.92,
align = "hv")
ggsave("SuppFig2.pdf", device = cairo_pdf, width = 12, height = 4)
# or run the model
ptm <- proc.time()
phi_vec <- seq(0, 1, by = 0.05) # fine grid : by = 0.01
psi_vec <- seq(0, 1, by = 0.05)
df <- expand.grid(phi = phi_vec, psi = psi_vec)
df$Reff_baseline <- NA
df$tot_infections_baseline <- NA
df$Reff_waning <- NA
df$tot_infections_waning <- NA
df$Reff_boosting <- NA
df$tot_infections_boosting <- NA
for (this_scenario in 1:3){
if (this_scenario == 1){
# waning
my_VE_I <- low_VE_I
my_VE_S <- low_VE_S
my_H_I <- low_H_I
my_H_S <- low_H_S
} else if (this_scenario == 2){
# baseline
my_VE_I <- this_VE_I
my_VE_S <- this_VE_S
my_H_I <- this_H_I
my_H_S <- this_H_S
} else {
# boosting
my_VE_I <- boosted_VE_I
my_VE_S <- boosted_VE_S
my_H_I <- boosted_H_I
my_H_S <- boosted_H_S
}
tot_infections <- c()
Reff <- c()
for (i in 1:dim(df)[1]){
tot_infections[i] <- compute_tot_infections(df$phi[i], VE_I = my_VE_I, VE_S = my_VE_S,
theta = 0, q = this_q,
df$psi[i], X_I = this_X_I, X_S = this_X_S,
H_I = my_H_I, H_S = my_H_S)
Reff[i] <- compute_Reff(df$phi[i], VE_I = my_VE_I, VE_S = my_VE_S,
theta = 0, q = this_q,
df$psi[i], X_I = this_X_I, X_S = this_X_S,
H_I = my_H_I, H_S = my_H_S)
}
if (this_scenario == 1){
df$tot_infections_waning <- tot_infections
df$Reff_waning <- Reff
} else if (this_scenario == 2){
df$tot_infections_baseline <- tot_infections
df$Reff_baseline <- Reff
} else {
df$tot_infections_boosted <- tot_infections
df$Reff_boosted <- Reff
}
}
#saveRDS(df,file="df_fig2_setupparams.RData")
proc.time() - ptm
p_Reff_waning <- ggplot(df, aes(x = phi*100, y = psi*100, z = Reff_waning))+ #, colour = ..level..)) +
geom_tile(aes(fill = tot_infections_waning)) +
geom_contour(breaks = 1:R0, size = 0.4, color = "white") +
geom_text_contour(breaks = 1:R0, color = "white", rotate = FALSE, nudge_y = 1, nudge_x = 2, skip = 0)+
scale_y_continuous(expand = c(0, 0)) +
scale_x_continuous(expand = c(0, 0)) +
ylab("Infection-acquired immunity (%)") +
xlab("") +# xlab("Population vaccination rate (%)") +
ggtitle("Waning scenario") +
scale_fill_viridis(option="viridis", limits = c(0, N)) +
coord_fixed(1) +
theme(legend.position = "none")
p_Reff_baseline <- ggplot(df, aes(x = phi*100, y = psi*100, z = Reff_baseline))+ #, colour = ..level..)) +
geom_tile(aes(fill = tot_infections_baseline)) +
geom_contour(breaks = 1:R0, size = 0.4, color = "white") +
geom_text_contour(breaks = 1:R0, color = "white", rotate = FALSE, nudge_y = 1, nudge_x = 2, skip = 0)+
scale_y_continuous(expand = c(0, 0)) +
scale_x_continuous(expand = c(0, 0)) +
ylab("") +
xlab("Population vaccination rate (%)") +
ggtitle("Baseline") +
scale_fill_viridis(option="viridis", limits = c(0, N)) +
coord_fixed(1) +
theme(legend.position = "none",
axis.title.y = element_blank())
p_Reff_boosted <- ggplot(df, aes(x = phi*100, y = psi*100, z = Reff_boosted))+ #, colour = ..level..)) +
geom_tile(aes(fill = tot_infections_boosted)) +
geom_contour(breaks = 1:R0, size = 0.4, color = "white") +
geom_text_contour(breaks = 1:R0, color = "white", rotate = FALSE, nudge_y = 1, nudge_x = 2, skip = 0)+
scale_y_continuous(expand = c(0, 0)) +
scale_x_continuous(expand = c(0, 0)) +
ylab("") +
xlab("") + # xlab("Population vaccination rate (%)") +
ggtitle("Boosted scenario") +
scale_fill_viridis(option="viridis", limits = c(0, N)) +
coord_fixed(1) +
labs(fill = "") +
theme(legend.text = element_text(size = 11),
legend.spacing.x = unit(0.7, 'cm'),
axis.title.y = element_blank())
num_legend <- get_legend(p_Reff_boosted)
p_Reff_boosted <- p_Reff_boosted + theme(legend.position = "none")
panels <- ggarrange(p_Reff_waning, p_Reff_baseline, p_Reff_boosted,
widths = c(1, 1, 1),
labels = c('a  ', 'b', 'c'),
ncol = 3,
label.y = 0.92,
align = "hv")
fig3 <- arrangeGrob(panels, num_legend,
nrow = 1,
widths = c(3, 0.5))
fig3
panels
ggsave("SuppFig3.pdf", fig3, device = cairo_pdf, width = 12, height = 4)
# or run the model
ptm <- proc.time()
phi_vec <- seq(0, 1, by = 0.05)
psi_vec <- seq(0, 1, by = 0.05)
df <- expand.grid(phi = phi_vec, psi = psi_vec)
df$Reff <- NA
df$Reff_99 <- NA
df$Reff_50 <- NA
df$totinfections_notesting <- NA
df$totinfections_99 <- NA
df$totinfections_50 <- NA
this_VE_I <- boosted_VE_I
this_VE_S <- boosted_VE_S
this_H_I  <- boosted_H_I
this_H_S  <- boosted_H_S
for (i in 1:dim(df)[1]){
df$Reff[i] <- compute_Reff(df$phi[i], VE_I = this_VE_I, VE_S = this_VE_S,
theta = 0, q = this_q,
df$psi[i], X_I = this_X_I, X_S = this_X_S,
H_I = this_H_I, H_S = this_H_S)
df$Reff_99[i] <- compute_Reff(df$phi[i], VE_I = this_VE_I, VE_S = this_VE_S,
theta = theta_99, q = this_q,
df$psi[i], X_I = this_X_I, X_S = this_X_S,
H_I = this_H_I, H_S = this_H_S)
df$Reff_50[i] <- compute_Reff(df$phi[i], VE_I = this_VE_I, VE_S = this_VE_S,
theta = theta_50, q = this_q,
df$psi[i], X_I = this_X_I, X_S = this_X_S,
H_I = this_H_I, H_S = this_H_S)
df$totinfections_notesting[i] <- compute_tot_infections(df$phi[i], VE_I = this_VE_I, VE_S = this_VE_S,
theta = 0, q = this_q,
df$psi[i], X_I = this_X_I, X_S = this_X_S,
H_I = this_H_I, H_S = this_H_S)
df$totinfections_99[i] <- compute_tot_infections(df$phi[i], VE_I = this_VE_I, VE_S = this_VE_S,
theta = theta_99, q = this_q,
df$psi[i], X_I = this_X_I, X_S = this_X_S,
H_I = this_H_I, H_S = this_H_S)
df$totinfections_50[i] <- compute_tot_infections(df$phi[i], VE_I = this_VE_I, VE_S = this_VE_S,
theta = theta_50, q = this_q,
df$psi[i], X_I = this_X_I, X_S = this_X_S,
H_I = this_H_I, H_S = this_H_S)
}
df$percent_reduc_inf_99 <- (df$totinfections_notesting - df$totinfections_99)/df$totinfections_notesting*100
df$percent_reduc_inf_50 <- (df$totinfections_notesting - df$totinfections_50)/df$totinfections_notesting*100
# stat_contour(aes(z = Reff_99), breaks = 1, size = mylinesize, col = "white") +
#   #stat_contour(aes(z = Reff), breaks = 1, size = mylinesize, col = mylightgray, linetype = "longdash") +
p_totinfections_50 <- ggplot(df, aes(x = phi*100, y = psi*100)) + #, colour = ..level..)) +
geom_tile(aes(fill = totinfections_50)) +
geom_contour(aes(z = Reff_50), breaks = 1, size = 0.4, color = "white") +
geom_contour(aes(z = Reff), breaks = 1, size = 0.4, col = mylightgray, linetype = "longdash") +
scale_y_continuous(expand = c(0, 0)) +
scale_x_continuous(expand = c(0, 0)) +
ylab("Infection-acquired immunity (%)") +
xlab("") +# xlab("Population vaccination rate (%)") +
ggtitle("Weekly testing, 50% compliance", "Total infections") +
scale_fill_viridis(option="viridis", limits = c(0, N)) +
coord_fixed(1) +
theme(legend.position = "none",
plot.title = element_text(color = myyellow),
plot.subtitle = element_text(hjust = 0.5))
p_totinfections_99 <- ggplot(df, aes(x = phi*100, y = psi*100)) + #, colour = ..level..)) +
geom_tile(aes(fill = totinfections_99)) +
geom_contour(aes(z = Reff_99), breaks = 1, size = 0.4, color = "white") +
geom_contour(aes(z = Reff), breaks = 1, size = 0.4, col = mylightgray, linetype = "longdash") +
scale_y_continuous(expand = c(0, 0)) +
scale_x_continuous(expand = c(0, 0)) +
ylab("Infection-acquired immunity (%)") +
xlab("") +# xlab("Population vaccination rate (%)") +
ggtitle("Weekly testing, 99% compliance", "Total infections") +
scale_fill_viridis(option="viridis", limits = c(0, N)) +
coord_fixed(1) +
theme(legend.position = "none",
plot.title = element_text(color = myblue),
plot.subtitle = element_text(hjust = 0.5))
p_percentreduc_50 <- ggplot(df, aes(x = phi*100, y = psi*100)) + #, colour = ..level..)) +
geom_tile(aes(fill = percent_reduc_inf_50)) +
geom_contour(aes(z = Reff_50), breaks = 1, size = 0.4, color = "white") +
geom_contour(aes(z = Reff), breaks = 1, size = 0.4, col = mylightgray, linetype = "longdash") +
scale_y_continuous(expand = c(0, 0)) +
scale_x_continuous(expand = c(0, 0)) +
ylab("Infection-acquired immunity (%)") +
xlab("") +# xlab("Population vaccination rate (%)") +
ggtitle("Weekly testing, 50% compliance", "% reduction in infections due to testing") +
scale_fill_gradientn(colours = cet_pal(5, name = "inferno"), limits = c(0, 100)) +
coord_fixed(1) +
theme(legend.position = "none",
plot.title = element_text(color = myyellow),
plot.subtitle = element_text(hjust = 0.5))
p_percentreduc_99 <- ggplot(df, aes(x = phi*100, y = psi*100)) + #, colour = ..level..)) +
geom_tile(aes(fill = percent_reduc_inf_99)) +
geom_contour(aes(z = Reff_99), breaks = 1, size = 0.4, color = "white") +
geom_contour(aes(z = Reff), breaks = 1, size = 0.4, col = mylightgray, linetype = "longdash") +
scale_y_continuous(expand = c(0, 0)) +
scale_x_continuous(expand = c(0, 0)) +
ylab("Infection-acquired immunity (%)") +
xlab("") +# xlab("Population vaccination rate (%)") +
ggtitle("Weekly testing, 99% compliance", "% reduction in infections due to testing") +
scale_fill_gradientn(colours = cet_pal(5, name = "inferno"), limits = c(0, 100)) +
coord_fixed(1) +
labs(fill = "") +
theme(plot.title = element_text(color = myblue),
plot.subtitle = element_text(hjust = 0.5))
percent_legend <- get_legend(p_percentreduc_99)
p_percentreduc_99 <- p_percentreduc_99 + theme(legend.position = "none")
panels <- ggarrange(p_totinfections_50, p_percentreduc_50,
p_totinfections_99, p_percentreduc_99,
nrow = 2, ncol = 2)
lay <- rbind(c(1, 2),
c(1, 3))
grid.arrange(panels, num_legend, percent_legend,
layout_matrix = lay)
fig4 <- arrangeGrob(panels, num_legend, percent_legend,
layout_matrix = lay,
widths = c(3, 0.5))
ggsave("SuppFig4_boosted.pdf", fig4, device = cairo_pdf, width = 8, height = 8)
R0
ptm <- proc.time()
phi_vec <- seq(0, 1, by = 0.05)
psi_vec <- seq(0, 1, by = 0.05)
df <- expand.grid(phi = phi_vec, psi = psi_vec)
df$Reff <- NA
df$Reff_99 <- NA
df$Reff_50 <- NA
df$totinfections_notesting <- NA
df$totinfections_99 <- NA
df$totinfections_50 <- NA
this_VE_I <- baseline_VE_I
this_VE_S <- baseline_VE_S
this_H_I  <- baseline_H_I
this_H_S  <- baseline_H_S
for (i in 1:dim(df)[1]){
df$Reff[i] <- compute_Reff(df$phi[i], VE_I = this_VE_I, VE_S = this_VE_S,
theta = 0, q = this_q,
df$psi[i], X_I = this_X_I, X_S = this_X_S,
H_I = this_H_I, H_S = this_H_S)
df$Reff_99[i] <- compute_Reff(df$phi[i], VE_I = this_VE_I, VE_S = this_VE_S,
theta = theta_99, q = this_q,
df$psi[i], X_I = this_X_I, X_S = this_X_S,
H_I = this_H_I, H_S = this_H_S)
df$Reff_50[i] <- compute_Reff(df$phi[i], VE_I = this_VE_I, VE_S = this_VE_S,
theta = theta_50, q = this_q,
df$psi[i], X_I = this_X_I, X_S = this_X_S,
H_I = this_H_I, H_S = this_H_S)
df$totinfections_notesting[i] <- compute_tot_infections(df$phi[i], VE_I = this_VE_I, VE_S = this_VE_S,
theta = 0, q = this_q,
df$psi[i], X_I = this_X_I, X_S = this_X_S,
H_I = this_H_I, H_S = this_H_S)
df$totinfections_99[i] <- compute_tot_infections(df$phi[i], VE_I = this_VE_I, VE_S = this_VE_S,
theta = theta_99, q = this_q,
df$psi[i], X_I = this_X_I, X_S = this_X_S,
H_I = this_H_I, H_S = this_H_S)
df$totinfections_50[i] <- compute_tot_infections(df$phi[i], VE_I = this_VE_I, VE_S = this_VE_S,
theta = theta_50, q = this_q,
df$psi[i], X_I = this_X_I, X_S = this_X_S,
H_I = this_H_I, H_S = this_H_S)
}
df$percent_reduc_inf_99 <- (df$totinfections_notesting - df$totinfections_99)/df$totinfections_notesting*100
df$percent_reduc_inf_50 <- (df$totinfections_notesting - df$totinfections_50)/df$totinfections_notesting*100
# stat_contour(aes(z = Reff_99), breaks = 1, size = mylinesize, col = "white") +
#   #stat_contour(aes(z = Reff), breaks = 1, size = mylinesize, col = mylightgray, linetype = "longdash") +
p_totinfections_50 <- ggplot(df, aes(x = phi*100, y = psi*100)) + #, colour = ..level..)) +
geom_tile(aes(fill = totinfections_50)) +
geom_contour(aes(z = Reff_50), breaks = 1, size = 0.4, color = "white") +
geom_contour(aes(z = Reff), breaks = 1, size = 0.4, col = mylightgray, linetype = "longdash") +
scale_y_continuous(expand = c(0, 0)) +
scale_x_continuous(expand = c(0, 0)) +
ylab("Infection-acquired immunity (%)") +
xlab("") +# xlab("Population vaccination rate (%)") +
ggtitle("Weekly testing, 50% compliance", "Total infections") +
scale_fill_viridis(option="viridis", limits = c(0, N)) +
coord_fixed(1) +
theme(legend.position = "none",
plot.title = element_text(color = myyellow),
plot.subtitle = element_text(hjust = 0.5))
p_totinfections_99 <- ggplot(df, aes(x = phi*100, y = psi*100)) + #, colour = ..level..)) +
geom_tile(aes(fill = totinfections_99)) +
geom_contour(aes(z = Reff_99), breaks = 1, size = 0.4, color = "white") +
geom_contour(aes(z = Reff), breaks = 1, size = 0.4, col = mylightgray, linetype = "longdash") +
scale_y_continuous(expand = c(0, 0)) +
scale_x_continuous(expand = c(0, 0)) +
ylab("Infection-acquired immunity (%)") +
xlab("") +# xlab("Population vaccination rate (%)") +
ggtitle("Weekly testing, 99% compliance", "Total infections") +
scale_fill_viridis(option="viridis", limits = c(0, N)) +
coord_fixed(1) +
theme(legend.position = "none",
plot.title = element_text(color = myblue),
plot.subtitle = element_text(hjust = 0.5))
p_percentreduc_50 <- ggplot(df, aes(x = phi*100, y = psi*100)) + #, colour = ..level..)) +
geom_tile(aes(fill = percent_reduc_inf_50)) +
geom_contour(aes(z = Reff_50), breaks = 1, size = 0.4, color = "white") +
geom_contour(aes(z = Reff), breaks = 1, size = 0.4, col = mylightgray, linetype = "longdash") +
scale_y_continuous(expand = c(0, 0)) +
scale_x_continuous(expand = c(0, 0)) +
ylab("Infection-acquired immunity (%)") +
xlab("") +# xlab("Population vaccination rate (%)") +
ggtitle("Weekly testing, 50% compliance", "% reduction in infections due to testing") +
scale_fill_gradientn(colours = cet_pal(5, name = "inferno"), limits = c(0, 100)) +
coord_fixed(1) +
theme(legend.position = "none",
plot.title = element_text(color = myyellow),
plot.subtitle = element_text(hjust = 0.5))
p_percentreduc_99 <- ggplot(df, aes(x = phi*100, y = psi*100)) + #, colour = ..level..)) +
geom_tile(aes(fill = percent_reduc_inf_99)) +
geom_contour(aes(z = Reff_99), breaks = 1, size = 0.4, color = "white") +
geom_contour(aes(z = Reff), breaks = 1, size = 0.4, col = mylightgray, linetype = "longdash") +
scale_y_continuous(expand = c(0, 0)) +
scale_x_continuous(expand = c(0, 0)) +
ylab("Infection-acquired immunity (%)") +
xlab("") +# xlab("Population vaccination rate (%)") +
ggtitle("Weekly testing, 99% compliance", "% reduction in infections due to testing") +
scale_fill_gradientn(colours = cet_pal(5, name = "inferno"), limits = c(0, 100)) +
coord_fixed(1) +
labs(fill = "") +
theme(plot.title = element_text(color = myblue),
plot.subtitle = element_text(hjust = 0.5))
percent_legend <- get_legend(p_percentreduc_99)
p_percentreduc_99 <- p_percentreduc_99 + theme(legend.position = "none")
panels <- ggarrange(p_totinfections_50, p_percentreduc_50,
p_totinfections_99, p_percentreduc_99,
nrow = 2, ncol = 2)
lay <- rbind(c(1, 2),
c(1, 3))
grid.arrange(panels, num_legend, percent_legend,
layout_matrix = lay)
fig4 <- arrangeGrob(panels, num_legend, percent_legend,
layout_matrix = lay,
widths = c(3, 0.5))
ggsave("SuppFig4_baseline.pdf", fig4, device = cairo_pdf, width = 8, height = 8)
ptm <- proc.time()
phi_vec <- seq(0, 1, by = 0.05)
psi_vec <- seq(0, 1, by = 0.05)
df <- expand.grid(phi = phi_vec, psi = psi_vec)
df$Reff <- NA
df$Reff_99 <- NA
df$Reff_50 <- NA
df$totinfections_notesting <- NA
df$totinfections_99 <- NA
df$totinfections_50 <- NA
this_VE_I <- low_VE_I
this_VE_S <- low_VE_S
this_H_I  <- low_H_I
this_H_S  <- low_H_S
for (i in 1:dim(df)[1]){
df$Reff[i] <- compute_Reff(df$phi[i], VE_I = this_VE_I, VE_S = this_VE_S,
theta = 0, q = this_q,
df$psi[i], X_I = this_X_I, X_S = this_X_S,
H_I = this_H_I, H_S = this_H_S)
df$Reff_99[i] <- compute_Reff(df$phi[i], VE_I = this_VE_I, VE_S = this_VE_S,
theta = theta_99, q = this_q,
df$psi[i], X_I = this_X_I, X_S = this_X_S,
H_I = this_H_I, H_S = this_H_S)
df$Reff_50[i] <- compute_Reff(df$phi[i], VE_I = this_VE_I, VE_S = this_VE_S,
theta = theta_50, q = this_q,
df$psi[i], X_I = this_X_I, X_S = this_X_S,
H_I = this_H_I, H_S = this_H_S)
df$totinfections_notesting[i] <- compute_tot_infections(df$phi[i], VE_I = this_VE_I, VE_S = this_VE_S,
theta = 0, q = this_q,
df$psi[i], X_I = this_X_I, X_S = this_X_S,
H_I = this_H_I, H_S = this_H_S)
df$totinfections_99[i] <- compute_tot_infections(df$phi[i], VE_I = this_VE_I, VE_S = this_VE_S,
theta = theta_99, q = this_q,
df$psi[i], X_I = this_X_I, X_S = this_X_S,
H_I = this_H_I, H_S = this_H_S)
df$totinfections_50[i] <- compute_tot_infections(df$phi[i], VE_I = this_VE_I, VE_S = this_VE_S,
theta = theta_50, q = this_q,
df$psi[i], X_I = this_X_I, X_S = this_X_S,
H_I = this_H_I, H_S = this_H_S)
}
df$percent_reduc_inf_99 <- (df$totinfections_notesting - df$totinfections_99)/df$totinfections_notesting*100
df$percent_reduc_inf_50 <- (df$totinfections_notesting - df$totinfections_50)/df$totinfections_notesting*100
# stat_contour(aes(z = Reff_99), breaks = 1, size = mylinesize, col = "white") +
#   #stat_contour(aes(z = Reff), breaks = 1, size = mylinesize, col = mylightgray, linetype = "longdash") +
p_totinfections_50 <- ggplot(df, aes(x = phi*100, y = psi*100)) + #, colour = ..level..)) +
geom_tile(aes(fill = totinfections_50)) +
geom_contour(aes(z = Reff_50), breaks = 1, size = 0.4, color = "white") +
geom_contour(aes(z = Reff), breaks = 1, size = 0.4, col = mylightgray, linetype = "longdash") +
scale_y_continuous(expand = c(0, 0)) +
scale_x_continuous(expand = c(0, 0)) +
ylab("Infection-acquired immunity (%)") +
xlab("") +# xlab("Population vaccination rate (%)") +
ggtitle("Weekly testing, 50% compliance", "Total infections") +
scale_fill_viridis(option="viridis", limits = c(0, N)) +
coord_fixed(1) +
theme(legend.position = "none",
plot.title = element_text(color = myyellow),
plot.subtitle = element_text(hjust = 0.5))
p_totinfections_99 <- ggplot(df, aes(x = phi*100, y = psi*100)) + #, colour = ..level..)) +
geom_tile(aes(fill = totinfections_99)) +
geom_contour(aes(z = Reff_99), breaks = 1, size = 0.4, color = "white") +
geom_contour(aes(z = Reff), breaks = 1, size = 0.4, col = mylightgray, linetype = "longdash") +
scale_y_continuous(expand = c(0, 0)) +
scale_x_continuous(expand = c(0, 0)) +
ylab("Infection-acquired immunity (%)") +
xlab("") +# xlab("Population vaccination rate (%)") +
ggtitle("Weekly testing, 99% compliance", "Total infections") +
scale_fill_viridis(option="viridis", limits = c(0, N)) +
coord_fixed(1) +
theme(legend.position = "none",
plot.title = element_text(color = myblue),
plot.subtitle = element_text(hjust = 0.5))
p_percentreduc_50 <- ggplot(df, aes(x = phi*100, y = psi*100)) + #, colour = ..level..)) +
geom_tile(aes(fill = percent_reduc_inf_50)) +
geom_contour(aes(z = Reff_50), breaks = 1, size = 0.4, color = "white") +
geom_contour(aes(z = Reff), breaks = 1, size = 0.4, col = mylightgray, linetype = "longdash") +
scale_y_continuous(expand = c(0, 0)) +
scale_x_continuous(expand = c(0, 0)) +
ylab("Infection-acquired immunity (%)") +
xlab("") +# xlab("Population vaccination rate (%)") +
ggtitle("Weekly testing, 50% compliance", "% reduction in infections due to testing") +
scale_fill_gradientn(colours = cet_pal(5, name = "inferno"), limits = c(0, 100)) +
coord_fixed(1) +
theme(legend.position = "none",
plot.title = element_text(color = myyellow),
plot.subtitle = element_text(hjust = 0.5))
p_percentreduc_99 <- ggplot(df, aes(x = phi*100, y = psi*100)) + #, colour = ..level..)) +
geom_tile(aes(fill = percent_reduc_inf_99)) +
geom_contour(aes(z = Reff_99), breaks = 1, size = 0.4, color = "white") +
geom_contour(aes(z = Reff), breaks = 1, size = 0.4, col = mylightgray, linetype = "longdash") +
scale_y_continuous(expand = c(0, 0)) +
scale_x_continuous(expand = c(0, 0)) +
ylab("Infection-acquired immunity (%)") +
xlab("") +# xlab("Population vaccination rate (%)") +
ggtitle("Weekly testing, 99% compliance", "% reduction in infections due to testing") +
scale_fill_gradientn(colours = cet_pal(5, name = "inferno"), limits = c(0, 100)) +
coord_fixed(1) +
labs(fill = "") +
theme(plot.title = element_text(color = myblue),
plot.subtitle = element_text(hjust = 0.5))
percent_legend <- get_legend(p_percentreduc_99)
p_percentreduc_99 <- p_percentreduc_99 + theme(legend.position = "none")
panels <- ggarrange(p_totinfections_50, p_percentreduc_50,
p_totinfections_99, p_percentreduc_99,
nrow = 2, ncol = 2)
lay <- rbind(c(1, 2),
c(1, 3))
grid.arrange(panels, num_legend, percent_legend,
layout_matrix = lay)
fig4 <- arrangeGrob(panels, num_legend, percent_legend,
layout_matrix = lay,
widths = c(3, 0.5))
ggsave("SuppFig4_waning.pdf", fig4, device = cairo_pdf, width = 8, height = 8)
