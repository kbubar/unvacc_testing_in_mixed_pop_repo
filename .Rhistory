ggtitle("Weekly testing, 50% compliance", "% reduction in infections due to testing") +
scale_fill_gradientn(colours = cet_pal(5, name = "inferno"), limits = c(0, 100)) +
coord_fixed(1) +
theme(legend.position = "none",
plot.title = element_text(color = myyellow),
plot.subtitle = element_text(hjust = 0.5))
p_percentreduc_99 <- ggplot(df, aes(x = phi*100, y = psi*100)) + #, colour = ..level..)) +
geom_tile(aes(fill = percent_reduc_inf_99)) +
geom_contour(aes(z = Reff_99), breaks = 1, size = 0.4, color = "white") +
geom_contour(aes(z = Reff), breaks = 1, size = 0.4, col = mylightgray, linetype = "longdash") +
scale_y_continuous(expand = c(0, 0)) +
scale_x_continuous(expand = c(0, 0)) +
ylab("Infection-acquired immunity (%)") +
xlab("") +# xlab("Population vaccination rate (%)") +
ggtitle("Weekly testing, 99% compliance", "% reduction in infections due to testing") +
scale_fill_gradientn(colours = cet_pal(5, name = "inferno"), limits = c(0, 100)) +
coord_fixed(1) +
labs(fill = "") +
theme(plot.title = element_text(color = myblue),
plot.subtitle = element_text(hjust = 0.5))
percent_legend <- get_legend(p_percentreduc_99)
p_percentreduc_99 <- p_percentreduc_99 + theme(legend.position = "none")
panels <- ggarrange(p_totinfections_50, p_percentreduc_50,
p_totinfections_99, p_percentreduc_99,
nrow = 2, ncol = 2)
lay <- rbind(c(1, 2),
c(1, 3))
grid.arrange(panels, num_legend, percent_legend,
layout_matrix = lay)
fig4 <- arrangeGrob(panels, num_legend, percent_legend,
layout_matrix = lay,
widths = c(3, 0.5))
ggsave("Fig4_baseline.pdf", fig4, device = cairo_pdf, width = 8, height = 8)
ptm <- proc.time()
phi_vec <- seq(0, 1, by = 0.05)
psi_vec <- seq(0, 1, by = 0.05)
df <- expand.grid(phi = phi_vec, psi = psi_vec)
df$Reff <- NA
df$Reff_99 <- NA
df$Reff_50 <- NA
df$totinfections_notesting <- NA
df$totinfections_99 <- NA
df$totinfections_50 <- NA
this_VE_I <- low_VE_I
this_VE_I <- low_VE_S
this_H_I  <- low_H_I
this_H_S  <- low_H_S
for (i in 1:dim(df)[1]){
df$Reff[i] <- compute_Reff(df$phi[i], VE_I = this_VE_I, VE_S = this_VE_S,
theta = 0, q = this_q,
df$psi[i], X_I = this_X_I, X_S = this_X_S,
H_I = this_H_I, H_S = this_H_S)
df$Reff_99[i] <- compute_Reff(df$phi[i], VE_I = this_VE_I, VE_S = this_VE_S,
theta = theta_99, q = this_q,
df$psi[i], X_I = this_X_I, X_S = this_X_S,
H_I = this_H_I, H_S = this_H_S)
df$Reff_50[i] <- compute_Reff(df$phi[i], VE_I = this_VE_I, VE_S = this_VE_S,
theta = theta_50, q = this_q,
df$psi[i], X_I = this_X_I, X_S = this_X_S,
H_I = this_H_I, H_S = this_H_S)
df$totinfections_notesting[i] <- compute_tot_infections(df$phi[i], VE_I = this_VE_I, VE_S = this_VE_S,
theta = 0, q = this_q,
df$psi[i], X_I = this_X_I, X_S = this_X_S,
H_I = this_H_I, H_S = this_H_S)
df$totinfections_99[i] <- compute_tot_infections(df$phi[i], VE_I = this_VE_I, VE_S = this_VE_S,
theta = theta_99, q = this_q,
df$psi[i], X_I = this_X_I, X_S = this_X_S,
H_I = this_H_I, H_S = this_H_S)
df$totinfections_50[i] <- compute_tot_infections(df$phi[i], VE_I = this_VE_I, VE_S = this_VE_S,
theta = theta_50, q = this_q,
df$psi[i], X_I = this_X_I, X_S = this_X_S,
H_I = this_H_I, H_S = this_H_S)
}
df$percent_reduc_inf_99 <- (df$totinfections_notesting - df$totinfections_99)/df$totinfections_notesting*100
df$percent_reduc_inf_50 <- (df$totinfections_notesting - df$totinfections_50)/df$totinfections_notesting*100
p_totinfections_50 <- ggplot(df, aes(x = phi*100, y = psi*100)) + #, colour = ..level..)) +
geom_tile(aes(fill = totinfections_50)) +
geom_contour(aes(z = Reff_50), breaks = 1, size = 0.4, color = "white") +
geom_contour(aes(z = Reff), breaks = 1, size = 0.4, col = mylightgray, linetype = "longdash") +
scale_y_continuous(expand = c(0, 0)) +
scale_x_continuous(expand = c(0, 0)) +
ylab("Infection-acquired immunity (%)") +
xlab("") +# xlab("Population vaccination rate (%)") +
ggtitle("Weekly testing, 50% compliance", "Total infections") +
scale_fill_viridis(option="viridis", limits = c(0, N)) +
coord_fixed(1) +
theme(legend.position = "none",
plot.title = element_text(color = myyellow),
plot.subtitle = element_text(hjust = 0.5))
p_totinfections_99 <- ggplot(df, aes(x = phi*100, y = psi*100)) + #, colour = ..level..)) +
geom_tile(aes(fill = totinfections_99)) +
geom_contour(aes(z = Reff_99), breaks = 1, size = 0.4, color = "white") +
geom_contour(aes(z = Reff), breaks = 1, size = 0.4, col = mylightgray, linetype = "longdash") +
scale_y_continuous(expand = c(0, 0)) +
scale_x_continuous(expand = c(0, 0)) +
ylab("Infection-acquired immunity (%)") +
xlab("") +# xlab("Population vaccination rate (%)") +
ggtitle("Weekly testing, 99% compliance", "Total infections") +
scale_fill_viridis(option="viridis", limits = c(0, N)) +
coord_fixed(1) +
theme(legend.position = "none",
plot.title = element_text(color = myblue),
plot.subtitle = element_text(hjust = 0.5))
p_percentreduc_50 <- ggplot(df, aes(x = phi*100, y = psi*100)) + #, colour = ..level..)) +
geom_tile(aes(fill = percent_reduc_inf_50)) +
geom_contour(aes(z = Reff_50), breaks = 1, size = 0.4, color = "white") +
geom_contour(aes(z = Reff), breaks = 1, size = 0.4, col = mylightgray, linetype = "longdash") +
scale_y_continuous(expand = c(0, 0)) +
scale_x_continuous(expand = c(0, 0)) +
ylab("Infection-acquired immunity (%)") +
xlab("") +# xlab("Population vaccination rate (%)") +
ggtitle("Weekly testing, 50% compliance", "% reduction in infections due to testing") +
scale_fill_gradientn(colours = cet_pal(5, name = "inferno"), limits = c(0, 100)) +
coord_fixed(1) +
theme(legend.position = "none",
plot.title = element_text(color = myyellow),
plot.subtitle = element_text(hjust = 0.5))
p_percentreduc_99 <- ggplot(df, aes(x = phi*100, y = psi*100)) + #, colour = ..level..)) +
geom_tile(aes(fill = percent_reduc_inf_99)) +
geom_contour(aes(z = Reff_99), breaks = 1, size = 0.4, color = "white") +
geom_contour(aes(z = Reff), breaks = 1, size = 0.4, col = mylightgray, linetype = "longdash") +
scale_y_continuous(expand = c(0, 0)) +
scale_x_continuous(expand = c(0, 0)) +
ylab("Infection-acquired immunity (%)") +
xlab("") +# xlab("Population vaccination rate (%)") +
ggtitle("Weekly testing, 99% compliance", "% reduction in infections due to testing") +
scale_fill_gradientn(colours = cet_pal(5, name = "inferno"), limits = c(0, 100)) +
coord_fixed(1) +
labs(fill = "") +
theme(plot.title = element_text(color = myblue),
plot.subtitle = element_text(hjust = 0.5))
percent_legend <- get_legend(p_percentreduc_99)
p_percentreduc_99 <- p_percentreduc_99 + theme(legend.position = "none")
panels <- ggarrange(p_totinfections_50, p_percentreduc_50,
p_totinfections_99, p_percentreduc_99,
nrow = 2, ncol = 2)
lay <- rbind(c(1, 2),
c(1, 3))
grid.arrange(panels, num_legend, percent_legend,
layout_matrix = lay)
fig4 <- arrangeGrob(panels, num_legend, percent_legend,
layout_matrix = lay,
widths = c(3, 0.5))
ggsave("Fig4_waning.pdf", fig4, device = cairo_pdf, width = 8, height = 8)
p_totinfections_50 <- ggplot(df, aes(x = phi*100, y = psi*100)) + #, colour = ..level..)) +
geom_tile(aes(fill = totinfections_50)) +
geom_contour(aes(z = Reff_50), breaks = 1, size = 0.4, color = "white") +
geom_contour(aes(z = Reff), breaks = 1, size = 0.4, col = mylightgray, linetype = "longdash") +
scale_y_continuous(expand = c(0, 0)) +
scale_x_continuous(expand = c(0, 0)) +
ylab("Infection-acquired immunity (%)") +
xlab("") +# xlab("Population vaccination rate (%)") +
ggtitle("Weekly testing, 50% compliance", "Total infections") +
scale_fill_viridis(option="viridis", limits = c(0, N)) +
coord_fixed(1) +
theme(legend.position = "none",
plot.title = element_text(color = myyellow),
plot.subtitle = element_text(hjust = 0.5))
p_totinfections_99 <- ggplot(df, aes(x = phi*100, y = psi*100)) + #, colour = ..level..)) +
geom_tile(aes(fill = totinfections_99)) +
geom_contour(aes(z = Reff_99), breaks = 1, size = 0.4, color = "white") +
geom_contour(aes(z = Reff), breaks = 1, size = 0.4, col = mylightgray, linetype = "longdash") +
scale_y_continuous(expand = c(0, 0)) +
scale_x_continuous(expand = c(0, 0)) +
ylab("Infection-acquired immunity (%)") +
xlab("") +# xlab("Population vaccination rate (%)") +
ggtitle("Weekly testing, 99% compliance", "Total infections") +
scale_fill_viridis(option="viridis", limits = c(0, N)) +
coord_fixed(1) +
theme(legend.position = "none",
plot.title = element_text(color = myblue),
plot.subtitle = element_text(hjust = 0.5))
p_percentreduc_50 <- ggplot(df, aes(x = phi*100, y = psi*100)) + #, colour = ..level..)) +
geom_tile(aes(fill = percent_reduc_inf_50)) +
geom_contour(aes(z = Reff_50), breaks = 1, size = 0.4, color = "white") +
geom_contour(aes(z = Reff), breaks = 1, size = 0.4, col = mylightgray, linetype = "longdash") +
scale_y_continuous(expand = c(0, 0)) +
scale_x_continuous(expand = c(0, 0)) +
ylab("Infection-acquired immunity (%)") +
xlab("") +# xlab("Population vaccination rate (%)") +
ggtitle("Weekly testing, 50% compliance", "% reduction in infections due to testing") +
scale_fill_gradientn(colours = cet_pal(5, name = "inferno"), limits = c(0, 100)) +
coord_fixed(1) +
theme(legend.position = "none",
plot.title = element_text(color = myyellow),
plot.subtitle = element_text(hjust = 0.5))
p_percentreduc_99 <- ggplot(df, aes(x = phi*100, y = psi*100)) + #, colour = ..level..)) +
geom_tile(aes(fill = percent_reduc_inf_99)) +
geom_contour(aes(z = Reff_99), breaks = 1, size = 0.4, color = "white") +
geom_contour(aes(z = Reff), breaks = 1, size = 0.4, col = mylightgray, linetype = "longdash") +
scale_y_continuous(expand = c(0, 0)) +
scale_x_continuous(expand = c(0, 0)) +
ylab("Infection-acquired immunity (%)") +
xlab("") +# xlab("Population vaccination rate (%)") +
ggtitle("Weekly testing, 99% compliance", "% reduction in infections due to testing") +
scale_fill_gradientn(colours = cet_pal(5, name = "inferno"), limits = c(0, 100)) +
coord_fixed(1) +
labs(fill = "") +
theme(plot.title = element_text(color = myblue),
plot.subtitle = element_text(hjust = 0.5))
percent_legend <- get_legend(p_percentreduc_99)
p_percentreduc_99 <- p_percentreduc_99 + theme(legend.position = "none")
panels <- ggarrange(p_totinfections_50, p_percentreduc_50,
p_totinfections_99, p_percentreduc_99,
nrow = 2, ncol = 2)
lay <- rbind(c(1, 2),
c(1, 3))
grid.arrange(panels, num_legend, percent_legend,
layout_matrix = lay)
fig4 <- arrangeGrob(panels, num_legend, percent_legend,
layout_matrix = lay,
widths = c(3, 0.5))
# or run the model
ptm <- proc.time()
phi_vec <- seq(0, 1, by = 0.05)
psi_vec <- seq(0, 1, by = 0.05)
df <- expand.grid(phi = phi_vec, psi = psi_vec)
df$Reff <- NA
df$Reff_99 <- NA
df$Reff_50 <- NA
df$totinfections_notesting <- NA
df$totinfections_99 <- NA
df$totinfections_50 <- NA
this_VE_I <- low_VE_I
this_VE_I <- low_VE_S
this_H_I  <- low_H_I
this_H_S  <- low_H_S
for (i in 1:dim(df)[1]){
df$Reff[i] <- compute_Reff(df$phi[i], VE_I = this_VE_I, VE_S = this_VE_S,
theta = 0, q = this_q,
df$psi[i], X_I = this_X_I, X_S = this_X_S,
H_I = this_H_I, H_S = this_H_S)
df$Reff_99[i] <- compute_Reff(df$phi[i], VE_I = this_VE_I, VE_S = this_VE_S,
theta = theta_99, q = this_q,
df$psi[i], X_I = this_X_I, X_S = this_X_S,
H_I = this_H_I, H_S = this_H_S)
df$Reff_50[i] <- compute_Reff(df$phi[i], VE_I = this_VE_I, VE_S = this_VE_S,
theta = theta_50, q = this_q,
df$psi[i], X_I = this_X_I, X_S = this_X_S,
H_I = this_H_I, H_S = this_H_S)
df$totinfections_notesting[i] <- compute_tot_infections(df$phi[i], VE_I = this_VE_I, VE_S = this_VE_S,
theta = 0, q = this_q,
df$psi[i], X_I = this_X_I, X_S = this_X_S,
H_I = this_H_I, H_S = this_H_S)
df$totinfections_99[i] <- compute_tot_infections(df$phi[i], VE_I = this_VE_I, VE_S = this_VE_S,
theta = theta_99, q = this_q,
df$psi[i], X_I = this_X_I, X_S = this_X_S,
H_I = this_H_I, H_S = this_H_S)
df$totinfections_50[i] <- compute_tot_infections(df$phi[i], VE_I = this_VE_I, VE_S = this_VE_S,
theta = theta_50, q = this_q,
df$psi[i], X_I = this_X_I, X_S = this_X_S,
H_I = this_H_I, H_S = this_H_S)
}
this_VE_I <- low_VE_I
this_VE_S <- low_VE_S
this_H_I  <- low_H_I
this_H_S  <- low_H_S
for (i in 1:dim(df)[1]){
df$Reff[i] <- compute_Reff(df$phi[i], VE_I = this_VE_I, VE_S = this_VE_S,
theta = 0, q = this_q,
df$psi[i], X_I = this_X_I, X_S = this_X_S,
H_I = this_H_I, H_S = this_H_S)
df$Reff_99[i] <- compute_Reff(df$phi[i], VE_I = this_VE_I, VE_S = this_VE_S,
theta = theta_99, q = this_q,
df$psi[i], X_I = this_X_I, X_S = this_X_S,
H_I = this_H_I, H_S = this_H_S)
df$Reff_50[i] <- compute_Reff(df$phi[i], VE_I = this_VE_I, VE_S = this_VE_S,
theta = theta_50, q = this_q,
df$psi[i], X_I = this_X_I, X_S = this_X_S,
H_I = this_H_I, H_S = this_H_S)
df$totinfections_notesting[i] <- compute_tot_infections(df$phi[i], VE_I = this_VE_I, VE_S = this_VE_S,
theta = 0, q = this_q,
df$psi[i], X_I = this_X_I, X_S = this_X_S,
H_I = this_H_I, H_S = this_H_S)
df$totinfections_99[i] <- compute_tot_infections(df$phi[i], VE_I = this_VE_I, VE_S = this_VE_S,
theta = theta_99, q = this_q,
df$psi[i], X_I = this_X_I, X_S = this_X_S,
H_I = this_H_I, H_S = this_H_S)
df$totinfections_50[i] <- compute_tot_infections(df$phi[i], VE_I = this_VE_I, VE_S = this_VE_S,
theta = theta_50, q = this_q,
df$psi[i], X_I = this_X_I, X_S = this_X_S,
H_I = this_H_I, H_S = this_H_S)
}
df$percent_reduc_inf_99 <- (df$totinfections_notesting - df$totinfections_99)/df$totinfections_notesting*100
df$percent_reduc_inf_50 <- (df$totinfections_notesting - df$totinfections_50)/df$totinfections_notesting*100
p_totinfections_50 <- ggplot(df, aes(x = phi*100, y = psi*100)) + #, colour = ..level..)) +
geom_tile(aes(fill = totinfections_50)) +
geom_contour(aes(z = Reff_50), breaks = 1, size = 0.4, color = "white") +
geom_contour(aes(z = Reff), breaks = 1, size = 0.4, col = mylightgray, linetype = "longdash") +
scale_y_continuous(expand = c(0, 0)) +
scale_x_continuous(expand = c(0, 0)) +
ylab("Infection-acquired immunity (%)") +
xlab("") +# xlab("Population vaccination rate (%)") +
ggtitle("Weekly testing, 50% compliance", "Total infections") +
scale_fill_viridis(option="viridis", limits = c(0, N)) +
coord_fixed(1) +
theme(legend.position = "none",
plot.title = element_text(color = myyellow),
plot.subtitle = element_text(hjust = 0.5))
p_totinfections_99 <- ggplot(df, aes(x = phi*100, y = psi*100)) + #, colour = ..level..)) +
geom_tile(aes(fill = totinfections_99)) +
geom_contour(aes(z = Reff_99), breaks = 1, size = 0.4, color = "white") +
geom_contour(aes(z = Reff), breaks = 1, size = 0.4, col = mylightgray, linetype = "longdash") +
scale_y_continuous(expand = c(0, 0)) +
scale_x_continuous(expand = c(0, 0)) +
ylab("Infection-acquired immunity (%)") +
xlab("") +# xlab("Population vaccination rate (%)") +
ggtitle("Weekly testing, 99% compliance", "Total infections") +
scale_fill_viridis(option="viridis", limits = c(0, N)) +
coord_fixed(1) +
theme(legend.position = "none",
plot.title = element_text(color = myblue),
plot.subtitle = element_text(hjust = 0.5))
p_percentreduc_50 <- ggplot(df, aes(x = phi*100, y = psi*100)) + #, colour = ..level..)) +
geom_tile(aes(fill = percent_reduc_inf_50)) +
geom_contour(aes(z = Reff_50), breaks = 1, size = 0.4, color = "white") +
geom_contour(aes(z = Reff), breaks = 1, size = 0.4, col = mylightgray, linetype = "longdash") +
scale_y_continuous(expand = c(0, 0)) +
scale_x_continuous(expand = c(0, 0)) +
ylab("Infection-acquired immunity (%)") +
xlab("") +# xlab("Population vaccination rate (%)") +
ggtitle("Weekly testing, 50% compliance", "% reduction in infections due to testing") +
scale_fill_gradientn(colours = cet_pal(5, name = "inferno"), limits = c(0, 100)) +
coord_fixed(1) +
theme(legend.position = "none",
plot.title = element_text(color = myyellow),
plot.subtitle = element_text(hjust = 0.5))
p_percentreduc_99 <- ggplot(df, aes(x = phi*100, y = psi*100)) + #, colour = ..level..)) +
geom_tile(aes(fill = percent_reduc_inf_99)) +
geom_contour(aes(z = Reff_99), breaks = 1, size = 0.4, color = "white") +
geom_contour(aes(z = Reff), breaks = 1, size = 0.4, col = mylightgray, linetype = "longdash") +
scale_y_continuous(expand = c(0, 0)) +
scale_x_continuous(expand = c(0, 0)) +
ylab("Infection-acquired immunity (%)") +
xlab("") +# xlab("Population vaccination rate (%)") +
ggtitle("Weekly testing, 99% compliance", "% reduction in infections due to testing") +
scale_fill_gradientn(colours = cet_pal(5, name = "inferno"), limits = c(0, 100)) +
coord_fixed(1) +
labs(fill = "") +
theme(plot.title = element_text(color = myblue),
plot.subtitle = element_text(hjust = 0.5))
percent_legend <- get_legend(p_percentreduc_99)
p_percentreduc_99 <- p_percentreduc_99 + theme(legend.position = "none")
panels <- ggarrange(p_totinfections_50, p_percentreduc_50,
p_totinfections_99, p_percentreduc_99,
nrow = 2, ncol = 2)
lay <- rbind(c(1, 2),
c(1, 3))
grid.arrange(panels, num_legend, percent_legend,
layout_matrix = lay)
fig4 <- arrangeGrob(panels, num_legend, percent_legend,
layout_matrix = lay,
widths = c(3, 0.5))
ggsave("Fig4_waning.pdf", fig4, device = cairo_pdf, width = 8, height = 8)
ptm <- proc.time()
phi_vec <- seq(0, 1, by = 0.05)
psi_vec <- seq(0, 1, by = 0.05)
df <- expand.grid(phi = phi_vec, psi = psi_vec)
df$Reff <- NA
df$Reff_99 <- NA
df$Reff_50 <- NA
df$totinfections_notesting <- NA
df$totinfections_99 <- NA
df$totinfections_50 <- NA
this_VE_I <- boosted_VE_I
this_VE_S <- boosted_VE_S
this_H_I  <- boosted_H_I
this_H_S  <- boosted_H_S
for (i in 1:dim(df)[1]){
df$Reff[i] <- compute_Reff(df$phi[i], VE_I = this_VE_I, VE_S = this_VE_S,
theta = 0, q = this_q,
df$psi[i], X_I = this_X_I, X_S = this_X_S,
H_I = this_H_I, H_S = this_H_S)
df$Reff_99[i] <- compute_Reff(df$phi[i], VE_I = this_VE_I, VE_S = this_VE_S,
theta = theta_99, q = this_q,
df$psi[i], X_I = this_X_I, X_S = this_X_S,
H_I = this_H_I, H_S = this_H_S)
df$Reff_50[i] <- compute_Reff(df$phi[i], VE_I = this_VE_I, VE_S = this_VE_S,
theta = theta_50, q = this_q,
df$psi[i], X_I = this_X_I, X_S = this_X_S,
H_I = this_H_I, H_S = this_H_S)
df$totinfections_notesting[i] <- compute_tot_infections(df$phi[i], VE_I = this_VE_I, VE_S = this_VE_S,
theta = 0, q = this_q,
df$psi[i], X_I = this_X_I, X_S = this_X_S,
H_I = this_H_I, H_S = this_H_S)
df$totinfections_99[i] <- compute_tot_infections(df$phi[i], VE_I = this_VE_I, VE_S = this_VE_S,
theta = theta_99, q = this_q,
df$psi[i], X_I = this_X_I, X_S = this_X_S,
H_I = this_H_I, H_S = this_H_S)
df$totinfections_50[i] <- compute_tot_infections(df$phi[i], VE_I = this_VE_I, VE_S = this_VE_S,
theta = theta_50, q = this_q,
df$psi[i], X_I = this_X_I, X_S = this_X_S,
H_I = this_H_I, H_S = this_H_S)
}
df$percent_reduc_inf_99 <- (df$totinfections_notesting - df$totinfections_99)/df$totinfections_notesting*100
df$percent_reduc_inf_50 <- (df$totinfections_notesting - df$totinfections_50)/df$totinfections_notesting*100
baseline_X_S <- 0.63 # Gardner 2021
baseline_X_I <- 0.13 # Gardner 2021
this_X_S <- baseline_X_S
this_X_I <- baseline_X_I
this_H_S = (1-this_X_S)*this_VE_S + this_X_S  # 0.91
this_H_I = (1-this_X_I)*this_VE_I + this_X_I  # 0.57
this_VE_S <- 0.65 # best guess from lots of sources including Gardner
this_VE_I <- 0.35  # best guess from lots of sources including Eyre (UK)
this_psi <- 0.35  # CDC estimate
baseline_X_S <- 0.63 # Gardner 2021
baseline_X_I <- 0.13 # Gardner 2021
this_X_S <- baseline_X_S
this_X_I <- baseline_X_I
this_H_S = (1-this_X_S)*this_VE_S + this_X_S  # 0.91
this_H_I = (1-this_X_I)*this_VE_I + this_X_I  # 0.57
baseline_VE_S <- 0.65 # best guess from lots of sources including Gardner
baseline_VE_I <- 0.35  # best guess from lots of sources including Eyre (UK)
this_VE_S <- baseline_VE_S
this_VE_I <- baseline_VE_I
this_psi <- 0.35  # CDC estimate
this_X_S <- 0.63 # Gardner 2021
this_X_I <- 0.13 # Gardner 2021
this_H_S = (1-this_X_S)*this_VE_S + this_X_S  # 0.89 for baseline scenario
this_H_I = (1-this_X_I)*this_VE_I + this_X_I  # 0.57 for baseline scenario
# VE Uncertainty parameters
boosted_VE_S = 0.8
boosted_VE_I = 0.6
boosted_H_S = (1-this_X_S)*boosted_VE_S + this_X_S
boosted_H_I = (1-this_X_I)*boosted_VE_I + this_X_I
low_VE_S = 0.5
low_VE_I = 0.1
low_H_S = (1-this_X_S)*low_VE_S + this_X_S
low_H_I = (1-this_X_I)*low_VE_I + this_X_I
baseline_VE_S <- 0.65 # best guess from lots of sources including Gardner
baseline_VE_I <- 0.35  # best guess from lots of sources including Eyre (UK)
this_VE_S <- baseline_VE_S
this_VE_I <- baseline_VE_I
this_psi <- 0.35  # CDC estimate
this_X_S <- 0.63 # Gardner 2021
this_X_I <- 0.13 # Gardner 2021
this_H_S <- (1-this_X_S)*this_VE_S + this_X_S  # 0.87 for baseline scenario
this_H_I <- (1-this_X_I)*this_VE_I + this_X_I  # 0.43 for baseline scenario
# waning
my_VE_I <- low_VE_I
my_VE_S <- low_VE_S
df$percent_reduc_inf_99 <- (df$totinfections_notesting - df$totinfections_99)/df$totinfections_notesting*100
df$percent_reduc_inf_50 <- (df$totinfections_notesting - df$totinfections_50)/df$totinfections_notesting*100
p_totinfections_50 <- ggplot(df, aes(x = phi*100, y = psi*100)) + #, colour = ..level..)) +
geom_tile(aes(fill = totinfections_50)) +
geom_contour(aes(z = Reff_50), breaks = 1, size = 0.4, color = "white") +
geom_contour(aes(z = Reff), breaks = 1, size = 0.4, col = mylightgray, linetype = "longdash") +
scale_y_continuous(expand = c(0, 0)) +
scale_x_continuous(expand = c(0, 0)) +
ylab("Infection-acquired immunity (%)") +
xlab("") +# xlab("Population vaccination rate (%)") +
ggtitle("Weekly testing, 50% compliance", "Total infections") +
scale_fill_viridis(option="viridis", limits = c(0, N)) +
coord_fixed(1) +
theme(legend.position = "none",
plot.title = element_text(color = myyellow),
plot.subtitle = element_text(hjust = 0.5))
p_totinfections_99 <- ggplot(df, aes(x = phi*100, y = psi*100)) + #, colour = ..level..)) +
geom_tile(aes(fill = totinfections_99)) +
geom_contour(aes(z = Reff_99), breaks = 1, size = 0.4, color = "white") +
geom_contour(aes(z = Reff), breaks = 1, size = 0.4, col = mylightgray, linetype = "longdash") +
scale_y_continuous(expand = c(0, 0)) +
scale_x_continuous(expand = c(0, 0)) +
ylab("Infection-acquired immunity (%)") +
xlab("") +# xlab("Population vaccination rate (%)") +
ggtitle("Weekly testing, 99% compliance", "Total infections") +
scale_fill_viridis(option="viridis", limits = c(0, N)) +
coord_fixed(1) +
theme(legend.position = "none",
plot.title = element_text(color = myblue),
plot.subtitle = element_text(hjust = 0.5))
p_percentreduc_50 <- ggplot(df, aes(x = phi*100, y = psi*100)) + #, colour = ..level..)) +
geom_tile(aes(fill = percent_reduc_inf_50)) +
geom_contour(aes(z = Reff_50), breaks = 1, size = 0.4, color = "white") +
geom_contour(aes(z = Reff), breaks = 1, size = 0.4, col = mylightgray, linetype = "longdash") +
scale_y_continuous(expand = c(0, 0)) +
scale_x_continuous(expand = c(0, 0)) +
ylab("Infection-acquired immunity (%)") +
xlab("") +# xlab("Population vaccination rate (%)") +
ggtitle("Weekly testing, 50% compliance", "% reduction in infections due to testing") +
scale_fill_gradientn(colours = cet_pal(5, name = "inferno"), limits = c(0, 100)) +
coord_fixed(1) +
theme(legend.position = "none",
plot.title = element_text(color = myyellow),
plot.subtitle = element_text(hjust = 0.5))
p_percentreduc_99 <- ggplot(df, aes(x = phi*100, y = psi*100)) + #, colour = ..level..)) +
geom_tile(aes(fill = percent_reduc_inf_99)) +
geom_contour(aes(z = Reff_99), breaks = 1, size = 0.4, color = "white") +
geom_contour(aes(z = Reff), breaks = 1, size = 0.4, col = mylightgray, linetype = "longdash") +
scale_y_continuous(expand = c(0, 0)) +
scale_x_continuous(expand = c(0, 0)) +
ylab("Infection-acquired immunity (%)") +
xlab("") +# xlab("Population vaccination rate (%)") +
ggtitle("Weekly testing, 99% compliance", "% reduction in infections due to testing") +
scale_fill_gradientn(colours = cet_pal(5, name = "inferno"), limits = c(0, 100)) +
coord_fixed(1) +
labs(fill = "") +
theme(plot.title = element_text(color = myblue),
plot.subtitle = element_text(hjust = 0.5))
percent_legend <- get_legend(p_percentreduc_99)
p_percentreduc_99 <- p_percentreduc_99 + theme(legend.position = "none")
panels <- ggarrange(p_totinfections_50, p_percentreduc_50,
p_totinfections_99, p_percentreduc_99,
nrow = 2, ncol = 2)
lay <- rbind(c(1, 2),
c(1, 3))
grid.arrange(panels, num_legend, percent_legend,
layout_matrix = lay)
fig4 <- arrangeGrob(panels, num_legend, percent_legend,
layout_matrix = lay,
widths = c(3, 0.5))
ggsave("Fig4_boosted.pdf", fig4, device = cairo_pdf, width = 8, height = 8)
