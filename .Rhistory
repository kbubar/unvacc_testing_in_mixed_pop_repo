install.packages("tidyverse", dependencies = TRUE)
install.packages("ggplot2", dependencies = TRUE)
install.packages("gapminder")
install.packages("faraway", dependencies = TRUE)
install.packages("faraway", dependencies = TRUE)
install.packages("faraway", dependencies = TRUE)
install.packages('faraway', repos='http://cran.us.r-project.org')
library(ggplot2)
library(deSolve)
library(reshape2)
library(plyr)
library(scico)
library(ggpubr)
library(grid)
library(pracma)
setwd("~/student_testing_project")
source("student_testing_helpers.R")
install.packages(c("deSolve", "reshape2", "plyr", "scico", "ggpubr", "grid", "pracma"))
library(ggplot2)
library(deSolve)
library(reshape2)
library(plyr)
library(scico)
library(ggpubr)
library(grid)
library(pracma)
install.packages('ggpubr')
install.packages("ggpubr")
library(ggplot2)
install.packages("ggplot2")
library(ggplot2)
library(ggplot2)
library(ggplot2)
library(deSolve)
library(reshape2)
library(plyr)
library(scico)
library(ggpubr)
library(grid)
library(pracma)
library(r-ggplot2)
library(ggplot)
library(ggplot2)
install.packages("ggplot2")
ggplot2
library(ggplot2)
install.packages("ggplot2")
library(ggplot2)
library(ggplot2)
library(deSolve)
library(reshape2)
library(ggplot2)
install.packages("ggplot2")
install.packages("ggplot2")
install.packages("ggplot2", dependencies = TRUE)
library(ggplot2)
library(ggplot2)
1/5/(1-0.7)
1/5
.2*.7
1/0.3
5 * 0.3
5 * 0.5
1/5/(1-0.75
)
1/5/(1-0.5)
16*2.5**2 + 16 + 16*0.8
sqrt(128.8)
2.5**2
3*(6.25+25)+8
8*40.8
sqrt(3**2+4**2)
0.6 * (66+90+104)/3 + 0.4 * 90
(66+90+104)/3
qnorm(0.99,110,40.31^2)
qnorm(0.01,110,40.31^2)
qnorm(99,110,40.31^2)
install.packages("RCurl")
setwd("~/env/ActiveProjects/StudentTesting/unvacc_testing_in_mixed_pop_repo")
source("~/env/ActiveProjects/StudentTesting/unvacc_testing_in_mixed_pop_repo/setup.R")
# Either read in the corresponding RDS file
# Dataframes for supplementary mega figure 5
waningdf <- readRDS("df_suppFig5_waning_testeveryone_hosp.RData")
baselinedf <- readRDS("df_suppFig5_baseline_testeveryone_hosp.RData")
boosteddf <- readRDS("df_suppFig5_boosted_testeveryone_hosp.RData")
megafig_scenarios = c("hosp_testeveryone","hosp_uonly","inf_testeveryone")
for (m in megafig_scenarios){
base <- "percent_reduc_"
if (m == "hosp_testeveryone"){
fill_50 <- paste0(base,"hosp_50_testeveryone")
fill_99 <- paste0(base,"hosp_99_testeveryone")
Reff_50 <- "Reff_50_everyone"
Reff_99 <- "Reff_99_everyone"
}
if (m == "hosp_uonly"){
fill_50 <-"percent_reduc_hosp_50_uonly"
fill_99 <- "percent_reduc_hosp_99_uonly"
Reff_50 <- "Reff_50_uonly"
Reff_99 <- "Reff_99_uonly"
}
if (m == "inf_testeveryone"){
fill_50 <- paste0(base,"inf_50_testeveryone")
fill_99 <- paste0(base,"inf_99_testeveryone")
Reff_50 <- "Reff_50_everyone"
Reff_99 <- "Reff_99_everyone"
}
#* II: Plot suppfig5 ####
for (i in 1:3) {
if (i == 1) {
df <- waningdf
} else if (i==2) {
df <- baselinedf
} else {
df <- boosteddf
}
percentreduc50 <- ggplot(df, aes(x = phi*100, y = psi*100)) + #, colour = ..level..)) +
geom_tile(aes_string(fill = fill_50)) +
geom_contour(aes_string(z = Reff_50), breaks = 1, size = 0.6, color = "white") +
geom_contour(aes(z = Reff), breaks = 1, size = 0.6, col = "white", linetype = "longdash") +
scale_y_continuous(expand = c(0, 0)) +
scale_x_continuous(expand = c(0, 0)) +
ylab("") +#"Infection-acquired immunity (%)") +
xlab("") +# xlab("Population vaccination rate (%)") +
ggtitle("") +
scale_fill_gradientn(colours = cet_pal(5, name = "inferno"), limits = c(0, 100)) +
coord_fixed(1) +
theme(legend.position = "none")
percentreduc99 <- ggplot(df, aes(x = phi*100, y = psi*100)) + #, colour = ..level..)) +
geom_tile(aes_string(fill = fill_99)) +
geom_contour(aes_string(z = Reff_99), breaks = 1, size = 0.6, col = "white") +
geom_contour(aes(z = Reff), breaks = 1, size = 0.6, col = "white", linetype = "longdash") +
scale_y_continuous(expand = c(0, 0)) +
scale_x_continuous(expand = c(0, 0)) +
ylab("Infection-acquired immunity (%)") +
xlab("") +# xlab("Population vaccination rate (%)") +
#ggtitle("Weekly testing, 99% compliance", "% reduction in infections due to testing") +
scale_fill_gradientn(colours = cet_pal(5, name = "inferno"), limits = c(0, 100)) +
coord_fixed(1) +
labs(fill = "") +
theme(axis.title.y = element_blank(),
plot.title = element_blank(),
plot.subtitle = element_blank()) #element_text(hjust = 0.5))
percent_legend <- get_legend(percentreduc99)
if (i == 1){
percentreduc50_waning <- percentreduc50 + onlyy_theme
percentreduc99_waning <- percentreduc99 + theme(legend.position = "none", plot.title = element_blank())
if (m == "inf_testeveryone") {
percentreduc50_waning <- percentreduc50_waning + ggtitle("Waning/low VE") }
if (m == "hosp_uonly") {
percentreduc99_waning <- percentreduc99_waning + alllabels_theme }
else { percentreduc99_waning <- percentreduc99_waning + onlyy_theme }
} else if (i == 2){
percentreduc50_baseline <- percentreduc50 + nolabels_theme
percentreduc99_baseline <- percentreduc99 + theme(legend.position = "none", plot.title = element_blank())
if (m == "inf_testeveryone") {
percentreduc50_baseline <- percentreduc50_baseline + ggtitle("Baseline VE") }
if (m == "hosp_uonly") {
percentreduc99_baseline <- percentreduc99_baseline + onlyx_theme +  xlab("Population vaccination rate (%)") }
else { percentreduc99_baseline <- percentreduc99_baseline + nolabels_theme }
} else {
percentreduc50_boosted <- percentreduc50 + nolabels_theme
percentreduc99_boosted <- percentreduc99 + theme(legend.position = "none", plot.title = element_blank())
if (m == "inf_testeveryone") {
percentreduc50_boosted <- percentreduc50_boosted + ggtitle("Boosted/high VE") }
if (m == "hosp_uonly") {
percentreduc99_boosted <- percentreduc99_boosted + onlyx_theme }
else { percentreduc99_boosted <- percentreduc99_boosted + nolabels_theme }
}
}
if (m == "inf_testeveryone"){
inf_everyone_panel <- ggarrange(percentreduc50_waning, NULL, percentreduc50_baseline, NULL, percentreduc50_boosted,
NULL, NULL, NULL, NULL, NULL,
percentreduc99_waning, NULL, percentreduc99_baseline, NULL, percentreduc99_boosted,
nrow = 3, ncol = 5,
align = "hv",
widths = c(1, -0.14, 1, -0.14, 1),
heights = c(1, -0.22, 1),
labels = c("a", NA, "    b", NA,"    c",
NA, NA, NA, NA, NA,
"d", NA, "    e", NA, "    f"),
label.y = 0.88)
}
if (m == "hosp_testeveryone"){
hosp_everyone_panel <- ggarrange(percentreduc50_waning, NULL, percentreduc50_baseline, NULL, percentreduc50_boosted,
NULL, NULL, NULL, NULL, NULL,
percentreduc99_waning, NULL, percentreduc99_baseline, NULL, percentreduc99_boosted,
nrow = 3, ncol = 5,
align = "hv",
widths = c(1, -0.14, 1, -0.14, 1),
heights = c(1, -0.22, 1),
labels = c("g", NA, "    h", NA,"    i",
NA, NA, NA, NA, NA,
"j", NA, "    k", NA, "    l"),
label.y = 0.88)
}
if (m == "hosp_uonly"){
hosp_uonly_panel <-ggarrange(percentreduc50_waning, NULL, percentreduc50_baseline, NULL, percentreduc50_boosted,
NULL, NULL, NULL, NULL, NULL,
percentreduc99_waning, NULL, percentreduc99_baseline, NULL, percentreduc99_boosted,
nrow = 3, ncol = 5,
align = "hv",
widths = c(1, -0.14, 1, -0.14, 1),
heights = c(1, -0.22, 1),
labels = c("m", NA, "    n", NA,"    o",
NA, NA, NA, NA, NA,
"p", NA, "    q", NA, "    r"),
label.y = 0.88)
}
}
for (m in megafig_scenarios){
base <- "percent_reduc_"
if (m == "hosp_testeveryone"){
fill_50 <- paste0(base,"hosp_50_testeveryone")
fill_99 <- paste0(base,"hosp_99_testeveryone")
Reff_50 <- "Reff_50_everyone"
Reff_99 <- "Reff_99_everyone"
}
if (m == "hosp_uonly"){
fill_50 <-"percent_reduc_hosp_50_uonly"
fill_99 <- "percent_reduc_hosp_99_uonly"
Reff_50 <- "Reff_50_uonly"
Reff_99 <- "Reff_99_uonly"
}
if (m == "inf_testeveryone"){
fill_50 <- paste0(base,"inf_50_testeveryone")
fill_99 <- paste0(base,"inf_99_testeveryone")
Reff_50 <- "Reff_50_everyone"
Reff_99 <- "Reff_99_everyone"
}
#* II: Plot suppfig5 ####
for (i in 1:3) {
if (i == 1) {
df <- waningdf
} else if (i==2) {
df <- baselinedf
} else {
df <- boosteddf
}
percentreduc50 <- ggplot(df, aes(x = phi*100, y = psi*100)) + #, colour = ..level..)) +
geom_raster(aes_string(fill = fill_50)) +
geom_contour(aes_string(z = Reff_50), breaks = 1, size = 0.6, color = "white") +
geom_contour(aes(z = Reff), breaks = 1, size = 0.6, col = "white", linetype = "longdash") +
scale_y_continuous(expand = c(0, 0)) +
scale_x_continuous(expand = c(0, 0)) +
ylab("") +#"Infection-acquired immunity (%)") +
xlab("") +# xlab("Population vaccination rate (%)") +
ggtitle("") +
scale_fill_gradientn(colours = cet_pal(5, name = "inferno"), limits = c(0, 100)) +
coord_fixed(1) +
theme(legend.position = "none")
percentreduc99 <- ggplot(df, aes(x = phi*100, y = psi*100)) + #, colour = ..level..)) +
geom_raster(aes_string(fill = fill_99)) +
geom_contour(aes_string(z = Reff_99), breaks = 1, size = 0.6, col = "white") +
geom_contour(aes(z = Reff), breaks = 1, size = 0.6, col = "white", linetype = "longdash") +
scale_y_continuous(expand = c(0, 0)) +
scale_x_continuous(expand = c(0, 0)) +
ylab("Infection-acquired immunity (%)") +
xlab("") +# xlab("Population vaccination rate (%)") +
#ggtitle("Weekly testing, 99% compliance", "% reduction in infections due to testing") +
scale_fill_gradientn(colours = cet_pal(5, name = "inferno"), limits = c(0, 100)) +
coord_fixed(1) +
labs(fill = "") +
theme(axis.title.y = element_blank(),
plot.title = element_blank(),
plot.subtitle = element_blank()) #element_text(hjust = 0.5))
percent_legend <- get_legend(percentreduc99)
if (i == 1){
percentreduc50_waning <- percentreduc50 + onlyy_theme
percentreduc99_waning <- percentreduc99 + theme(legend.position = "none", plot.title = element_blank())
if (m == "inf_testeveryone") {
percentreduc50_waning <- percentreduc50_waning + ggtitle("Waning/low VE") }
if (m == "hosp_uonly") {
percentreduc99_waning <- percentreduc99_waning + alllabels_theme }
else { percentreduc99_waning <- percentreduc99_waning + onlyy_theme }
} else if (i == 2){
percentreduc50_baseline <- percentreduc50 + nolabels_theme
percentreduc99_baseline <- percentreduc99 + theme(legend.position = "none", plot.title = element_blank())
if (m == "inf_testeveryone") {
percentreduc50_baseline <- percentreduc50_baseline + ggtitle("Baseline VE") }
if (m == "hosp_uonly") {
percentreduc99_baseline <- percentreduc99_baseline + onlyx_theme +  xlab("Population vaccination rate (%)") }
else { percentreduc99_baseline <- percentreduc99_baseline + nolabels_theme }
} else {
percentreduc50_boosted <- percentreduc50 + nolabels_theme
percentreduc99_boosted <- percentreduc99 + theme(legend.position = "none", plot.title = element_blank())
if (m == "inf_testeveryone") {
percentreduc50_boosted <- percentreduc50_boosted + ggtitle("Boosted/high VE") }
if (m == "hosp_uonly") {
percentreduc99_boosted <- percentreduc99_boosted + onlyx_theme }
else { percentreduc99_boosted <- percentreduc99_boosted + nolabels_theme }
}
}
if (m == "inf_testeveryone"){
inf_everyone_panel <- ggarrange(percentreduc50_waning, NULL, percentreduc50_baseline, NULL, percentreduc50_boosted,
NULL, NULL, NULL, NULL, NULL,
percentreduc99_waning, NULL, percentreduc99_baseline, NULL, percentreduc99_boosted,
nrow = 3, ncol = 5,
align = "hv",
widths = c(1, -0.14, 1, -0.14, 1),
heights = c(1, -0.22, 1),
labels = c("a", NA, "    b", NA,"    c",
NA, NA, NA, NA, NA,
"d", NA, "    e", NA, "    f"),
label.y = 0.88)
}
if (m == "hosp_testeveryone"){
hosp_everyone_panel <- ggarrange(percentreduc50_waning, NULL, percentreduc50_baseline, NULL, percentreduc50_boosted,
NULL, NULL, NULL, NULL, NULL,
percentreduc99_waning, NULL, percentreduc99_baseline, NULL, percentreduc99_boosted,
nrow = 3, ncol = 5,
align = "hv",
widths = c(1, -0.14, 1, -0.14, 1),
heights = c(1, -0.22, 1),
labels = c("g", NA, "    h", NA,"    i",
NA, NA, NA, NA, NA,
"j", NA, "    k", NA, "    l"),
label.y = 0.88)
}
if (m == "hosp_uonly"){
hosp_uonly_panel <-ggarrange(percentreduc50_waning, NULL, percentreduc50_baseline, NULL, percentreduc50_boosted,
NULL, NULL, NULL, NULL, NULL,
percentreduc99_waning, NULL, percentreduc99_baseline, NULL, percentreduc99_boosted,
nrow = 3, ncol = 5,
align = "hv",
widths = c(1, -0.14, 1, -0.14, 1),
heights = c(1, -0.22, 1),
labels = c("m", NA, "    n", NA,"    o",
NA, NA, NA, NA, NA,
"p", NA, "    q", NA, "    r"),
label.y = 0.88)
}
}
lay <- rbind(c(rep(1,10),NA,NA),
c(rep(2,10),3,NA),
c(rep(4,10),NA,NA))
suppfig5 <- grid.arrange(inf_everyone_panel, hosp_everyone_panel, percent_legend, hosp_uonly_panel,
layout_matrix = lay,
heights = c(1,1,1.15),
left = c("Infection-acquired immunity (%)"))
ggsave("suppFig5_megafig.pdf", suppfig5, device = cairo_pdf, width = 6, height = 10)
# Either read in the corresponding RDS file
# Dataframes for main text figure 5
waningdf <- readRDS("dataframes/df_Fig5_waning.RData")
baselinedf <- readRDS("dataframes/df_Fig5_baseline.RData")
boosteddf <- readRDS("dataframes/df_Fig5_boosted.RData")
